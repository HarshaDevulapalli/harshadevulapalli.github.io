<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>India: Social and Economic Caste Census 2011</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
    <script src="d3-tip.js"></script>
    <script src="colorbrewer.js" type="text/javascript"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <style>

        @import url(https://fonts.googleapis.com/css?family=Titillium+Web:400,400italic,700);

        *.districts {
            fill: none;
            stroke: #cfcfcf;
        }

        .d3-tip {
            line-height: 1.5;
            padding: 5px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            border-radius: 4px;
        }

        .toolTipHead {
            font-size: 14px;
        }

        .toolTipRank {
            font-size: 13px;        }

        .toolTipBody {
            font-size: 13px;
        }

        .legendTitle {
            font-family: "Titillium Web";
            font-size: 16px;
            color: #666;
            margin-left: -5px;
        }

        #legend {
            width: 500px;
            position: absolute;
            left: 480px;
            top: 30px;
        }

        li.key {
            float: left;
            border-top-width: 15px;
            border-top-style: solid;
            font-family: "Titillium Web";
            color: #666;
            font-size: 16px;
            width: 10%;
            padding-left: 0;
            padding-right: 0;
            list-style:none;
        }

    </style>
</head>
<body>
    <div class="btn-group pull-right">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
            Select Parameter <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li><a class="m" value="ratebyPopulation" href="#">Population</a></li>
            <li><a class="m" value="ratebyIlliteracy" href="#">Illiteracy</a></li>
            <li><a class="m" value="ratebyLiteracyBelowPrimary" href="#">Literacy Below Primary</a></li>
            <li><a class="m" value="ratebyPrimary" href="#">Primary</a></li>
            <li><a class="m" value="ratebyMiddle" href="#">Middle</a></li>
            <li><a class="m" value="ratebySecondary" href="#">Secondary</a></li>
            <li><a class="m" value="ratebyHigherSecondary" href="#">Higher Secondary</a></li>
            <li><a class="m" value="ratebyGraduate" href="#">Graduate</a></li>
            <li><a class="m" value="ratebyOther" href="#">Other</a></li>
        </ul>
    </div>
    <script>

        var width = 1000,
            height = 1000,
            centered;

        var projection = d3.geo.mercator()
                          .scale(1600)
                          .center([0,22.18])
                          .rotate([-80.02,0])
                          .translate([(width/2) -40,height/2]);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g");

        var ratebyPopulation2011 = {};
        var ratebyIlliteracy2011 = {};
        var ratebyLiteracyBelowPrimary2011 = {};
        var ratebyPrimary2011 = {};
        var ratebyMiddle2011 = {};
        var ratebySecondary2011 = {};
        var ratebyHigherSecondary2011 = {};
        var ratebyGraduate2011 = {};
        var ratebyOther2011 = {};
        var max;
        var min;

        // wrapper function to enable switching map and legend content
        function updateChoro(choro) {

            // function to read in data from csv file
            d3.csv("secc3.csv", function(error, data) {

                // set the colour scale of the choropleth map
                var cscale;
                var domain;


                if (choro == "ratebyPopulation") {
                    choro = ratebyPopulation2011;
                    cscale = colorbrewer.PuBu[9]
                    domain = 'Population '
                    column_selector='secc_popul'

                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyIlliteracy") {
                    choro = ratebyIlliteracy2011;
                    cscale = colorbrewer.Oranges[9]
                    domain = 'Illiteracy '
                    column_selector='secc_col2'

                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyLiteracyBelowPrimary") {
                    choro = ratebyLiteracyBelowPrimary2011;
                    cscale = colorbrewer.Reds[9]
                    domain = 'LiteracyBelowPrimary '
                    column_selector='secc_col4'
                    max = d3.max(data, function(d) { return d.secc_col4; });
                    min = d3.min(data, function(d) { return d.secc_col4; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyPrimary") {
                    choro = ratebyPrimary2011;
                    cscale = colorbrewer.Greens[9]
                    domain = 'Primary '
                    column_selector='secc_col6'
                    max = d3.max(data, function(d) { return d.secc_col6; });
                    min = d3.min(data, function(d) { return d.secc_col6; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyMiddle") {
                    choro = ratebyMiddle2011;
                    cscale = colorbrewer.Purples[9]
                    domain = 'Middle '
                    column_selector='secc_col8'
                    max = d3.max(data, function(d) { return d.secc_col8; });
                    min = d3.min(data, function(d) { return d.secc_col8; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebySecondary") {
                    choro = ratebySecondary2011;
                    cscale = colorbrewer.Oranges[9]
                    domain = 'Secondary '
                    column_selector='secc_col10'
                    max = d3.max(data, function(d) { return d.secc_col10; });
                    min = d3.min(data, function(d) { return d.secc_col10; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyHigherSecondary") {
                    choro = ratebyHigherSecondary2011;
                    cscale = colorbrewer.Reds[9]
                    domain = 'Higher Secondary '
                    column_selector='secc_col12'
                    max = d3.max(data, function(d) { return d.secc_col12; });
                    min = d3.min(data, function(d) { return d.secc_col12; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyGraduate") {
                    choro = ratebyGraduate2011;
                    cscale = colorbrewer.Greens[9]
                    domain = 'Graduate '
                    column_selector='secc_col14'
                    max = d3.max(data, function(d) { return d.secc_col14; });
                    min = d3.min(data, function(d) { return d.secc_col14; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }
                if (choro == "ratebyMiddle") {
                    choro = ratebyMiddle2011;
                    cscale = colorbrewer.Purples[9]
                    domain = 'Middle '
                    column_selector='secc_col16'
                    max = d3.max(data, function(d) { return d.secc_col16; });
                    min = d3.min(data, function(d) { return d.secc_col16; });
                    document.getElementById("legend").innerHTML="<span class = legendTitle>" + domain + "Data</span>";
                }

                var color = d3.scale.quantize()
                    .domain([min,max])
                    .range(cscale);

                data.forEach(function (d) {
                    ratebyPopulation2011[d.dz_label] = +d.population;
                    ratebyIlliteracy2011[d.dz_label] = +d.illiteracy;
                    ratebyLiteracyBelowPrimary2011[d.dz_label] = +d.literacybelowprimary;
                    ratebyPrimary2011[d.dz_label] = +d.primary;
                    ratebyMiddle2011[d.dz_label] = +d.middle;
                    ratebySecondary2011[d.dz_label] = +d.secondary;
                    ratebyHigherSecondary2011[d.dz_label] = +d.highersecondary;
                    ratebyGraduate2011[d.dz_label] = +d.graduate;
                    ratebyOther2011[d.dz_label] = +d.other;

                });

                // function to read in data from json file
                d3.json("geosecc3.json", function(error, geosecc3) {
                    var min;
                    var max;
                    // build the tool tip information boxes
                    var tip = d3.tip()
                        .attr('class', 'd3-tip')
                        .offset([0, 10])

                        .html(function (d) {
                            if (choro == ratebyPopulation2011) {
                                var y2011 = d.properties.secc_popul;
                            }
                            if (choro == ratebyIlliteracy2011) {
                                var y2011 = d.properties.secc_col2;
                            }
                            if (choro == ratebyLiteracyBelowPrimary2011) {
                                var y2011 = d.properties.secc_col4;
                            }
                            if (choro == ratebyPrimary2011) {
                                var y2011 = d.properties.secc_col6;
                            }
                            if (choro == ratebyMiddle2011) {
                                var y2011 = d.properties.secc_col8;
                            }
                            if (choro == ratebySecondary2011) {
                                var y2011 = d.properties.secc_col10;
                            }
                            if (choro == ratebyHigherSecondary2011) {
                                var y2011 = d.properties.secc_col2;
                            }
                            if (choro == ratebyGraduate2011) {
                                var y2011 = d.properties.secc_col14;
                            }
                            if (choro == ratebyOther2011) {
                                var y2011 = d.properties.secc_col16;
                            }
                            return "<span class ='toolTipHead'><b>District Name: " + d.properties.DISTRICT + "</b><br/>" +
                            "<span class ='toolTipRank'>Current Percentage of " + domain + " : " + y2011 + "</span><br/>"
                          })



                    var color = d3.scale.linear()
                              .range(cscale);

                    svg.call(tip);

                    d3.select("g")
                        .selectAll("path")
                        .remove();

                    // build the choropleth map
                    var appending = svg.selectAll("g")
                        .attr("class", "districts")
                        .data(topojson.feature(geosecc3, geosecc3.objects.districts).features);

                        // add new elements
                        appending.enter().append("path");

                        // update existing elements
                        appending.style("fill",
                        function (d) {
                            return color(d.properties[column_selector]);
                        })
                        .style("stroke", "white")
                        .style("stroke-width", 0.3)
                        .attr("d", path)
                        .on("click", clicked)

                        // rollover functionality to display tool tips
                        .on("mouseover", function (d) {
                            tip.show(d)
                            /*d3.select(this)
                              7  .transition().duration(200)
                                .style("fill", "white"); */
                        })
                        .on("mouseout", function () {
                            tip.hide()
                            d3.select(this)
                                .transition().duration(200)
                                /*style("fill",
                                function (d) {
                                    return color(d.properties[column_selector]);
                                })*/;
                        })

                    d3.select('#legend')
                        .selectAll('ul')
                        .remove();

                    // build the map legend
                    var legend = d3.select('#legend')
                        .append('ul')
                        .attr('class', 'list-inline');

                    var keys = legend.selectAll('li.key')
                        .data(color.range());

                    var legend_items = ["Low", "", "", "", "", "", "", "", "High"];

                    keys.enter().append('li')
                        .attr('class', 'key')
                        .style('border-top-color', String)
                        .text(function (d, i) {
                            return legend_items[i];
                        });
                })
            })
        }

        // zoom functionality written by the awesome Mike Bostock
        function clicked(d) {
            var x, y, k;

            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 4;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }

            svg.selectAll("path")
                    .classed("active", centered && function(d) { return d === centered; });

            svg.transition()
                    .duration(750)
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                    .style("stroke-width", 1.5 / k + "px");
        }

        // generate initial map using overall Data rank data
        //updateChoro("ratebyPopulation");

        // handle on click event to switch between maps
        d3.selectAll(".m")
                .on("click", function() {
                    var choro = this.getAttribute("value");
                    updateChoro(choro);
                });
    </script>
<div id="legend"></div>
</body>
</html>
