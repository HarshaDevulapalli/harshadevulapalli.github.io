<!DOCTYPE html>
<html lang="en">

<head>
    <title>How India Works</title>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="india_districts.json" <meta charset="UTF8"></script>
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:300,400,600,900" rel="stylesheet">
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
    <style>
    body {
        font-family: "Fira Sans Extra Condensed", sans-serif;
    }

    h1,
    h2,
    h3,
    h6 {

        text-align: center;
    }

    h1 {
        font-size: 2em;
        font-weight: 900;
    }

    p,
    ul {
        font-weight: 400;
        font-size: 1.25em;
    }

    h3 {
        font-size: 1em;
        font-weight: 600;
    }

    h4,
    h5,
    .label {
        font-size: 0.8em;
        font-weight: 400;
        text-align: left;
    }

    .stateLabel {
        font-size: 0.7em;
        font-weight: 400;

    }

    }

    h6 {
        color: #f49416;
        font-size: 0.8em;
        font-weight: 300;
    }

    path.hover {
        stroke-width: 1.25px;
        opacity: 1;
    }

    path {
        stroke-width: 0.75px;
        opacity: 0.9;
    }

    button {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
        text-decoration: underline;
    }

    #centered {
        width: 500px;
        text-align: left;
        margin: 0 auto;
    }

    .dataButtons {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
        text-decoration: underline;
    }

    .toolTip {
        position: absolute;
        display: none;
        min-width: 40px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1.5px solid #000000;
        padding: 10px;
        text-align: center;
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 400;
        font-size: 0.8em;
    }

    .annotation-group {
        pointer-events: none
    }

    .typesofworkers {
        margin-top: 25px;
    }

    div {
        margin: 15px;
    }
    </style>
</head>

<body>
    <div id="w3-container">
        <div id="typesofworkers" title="As defined in the Census" align="center" style="font-size : 1.5em"></div>
        <div id="datagroups" align="center" style="font-size : 1.2em"></div>
        <div id="industryviews" align="center"></div>
        <div id="ageviews" align="right"></div>
        <div id="sexviews" align="right"></div>
        <div id="scaleparameters" align="center"></div>
        <div id="dataparameters" align="center"></div>
        <div id="detailedindustries" align=right></div>
        <h3 id="instruction"></h3>
        <div id="canvas" align="center"></div>
        <h3> Notes </h3>
        <div id="notes" align="center"></div>
    </div>
    <script>
    var width = 800;
    var height = 800;

    var aspect = width / height,
        chart = d3.select('#chart');

    // d3.select(window)
    //     .on("resize", function() {
    //         var targetWidth = chart.node().getBoundingClientRect().width;
    //         chart.attr("width", targetWidth);
    //         chart.attr("height", targetWidth / aspect);
    //     });

    var zoom = d3.zoom()
        .on("zoom", zoomed);

    // Create SVG
    var svg = d3.select("#canvas")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("align", "center");

    function zoomed() {
        var transform = d3.event.transform;

        svg.style("stroke-width", 1.5 / transform.k + "px");
        svg.attr("transform", transform);
    }

    var geoProjection = d3.geoMercator()
        .scale(1200)
        .center([83, 23])
        .translate([width / 2, height / 2]);

    var geoPath = d3.geoPath()
        .projection(geoProjection);

    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    var Hyderabad = [536, 537]
    var Bangalore = [572, 583]
    var Chennai = [602, 603, 604]
    var Kolkata = [336, 337, 338, 341, 342, 343]
    var Mumbai = [517, 518, 519, 520, 521]
    var Delhi = [74, 75, 77, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 104, 105, 133, 138, 139, 140, 141, 142]


    d3.queue()
        .defer(d3.json, "india_districts.json")
        .defer(d3.csv, "mergedTotal_B1.csv")
        .defer(d3.csv, "Final2011.csv")
        .defer(d3.json, "india.json")
        .await(ready);




    function ready(error, india, Data, FinalData, indiaState) {

        if (error) throw error;

        var allStates = svg.append("g")
            .selectAll("path")
            .data(topojson.feature(indiaState, indiaState.objects.india).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .style("stroke", "#000000")
            .style("fill", "transparent")
            .style("stroke-width", "1.5px")

        var allDistricts = svg.append("g")
            .attr("id", "allDistricts")
            .selectAll("path")
            .data(topojson.feature(india, india.objects.india_district).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .attr("class", "district")
            .attr("id", function(d) {
                return ("b" + d.properties.censuscode)
            })
            .style("fill", "#f0f0f0")
            .style("stroke", "transparent")
            .style("stroke-width", '2px')
            .style("opacity", 0.85)

        const filterKeys = ["Regular Workers", "Seasonal Workers"]

        d3.select('#typesofworkers')
            .selectAll("path")
            .data(filterKeys)
            .enter()
            .append("button")
            .on("click", buttonClick)
            .attr("id", d => d)
            .attr("class", "workerButtons")
            .html(function(d) {
                return d;
            })


        backgroundColour = "#ED9722"

        function buttonClick(datapoint) {
            d3.selectAll(".workerButtons").style("background", "transparent")
            d3.select(this).style("background", backgroundColour)
            d3.selectAll(".dataButtons").remove()
            d3.selectAll(".parameterButtons").remove()
            d3.selectAll(".categoryButtons").remove()
            d3.selectAll(".industryButtons").remove()
            d3.selectAll(".annotation-group").remove();


            if (datapoint == "Regular Workers") {
                Main_Workers()
            }

            if (datapoint == "Seasonal Workers") {
                Marginal_Workers()
            }

        }

        function drawLegendandTooltip(colourScale, districtData, token) {

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,50)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Legend (in %)")
                .scale(colourScale)
                .orient("horizontal")
                .labelWrap(25)
                .shapeWidth(30)

            svg.select(".legendQuant")
                .call(legend);

            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode].toFixed(2));
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })

            if (token == "yes") {
                var newLabel = d3.selectAll(".legendCells").append("g").attr("class", "cell").attr("transform", "translate(128,0)")
                newLabel.append("rect").attr("class", "swatch").attr("height", "15").attr("width", "30").style("fill", "rgb(189,56,132)")
                newLabel.append("text").attr("class", "label").attr("transform", "translate(0,33)").style("text-anchor", "left").append("tspan").text("Top 10 districts")
            }

        }

        function Annotate(numbers) {
            d3.selectAll(".annotation-group").remove();

            const annotations = [{
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[5].toFixed(2) + " percent",
                        title: "Delhi NCR UA Region",
                        wrap: 300
                    },
                    subject: {
                        radius: 25

                    },
                    x: 275,
                    y: 270,
                    dy: -75,
                    dx: -75
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[4].toFixed(2) + " percent",
                        title: "Mumbai UA Region",
                        wrap: 100
                    },

                    subject: {
                        radius: 20

                    },
                    x: 195,
                    y: 490,
                    dy: 75,
                    dx: -75
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[0].toFixed(2) + " percent",
                        title: "Hyderabad UA Region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 300,
                    y: 527,
                    dy: 0,
                    dx: 100
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[3].toFixed(2) + " percent",
                        title: "Kolkata UA Region",
                        wrap: 100
                    },

                    subject: {
                        radius: 20

                    },
                    x: 515,
                    y: 410,
                    dy: 70,
                    dx: 70
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[2].toFixed(2) + " percent",
                        title: "Chennai UA Region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 335,
                    y: 625,
                    dy: 50,
                    dx: 50
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[1].toFixed(2) + " percent",
                        title: "Bangalore UA Region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 285,
                    y: 620,
                    dy: 100,
                    dx: -100
                }
            ].map(function(d) { d.color = "#000000"; return d })

            const makeAnnotations = d3.annotation()
                .type(d3.annotationLabel)
                .annotations(annotations)

            d3.select("svg")
                .append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations)
        }



        function Calculator(Data, kindofworker) {

            d3.select("#notes").text("Total Workforce is defined as the sum of all Main and Marginal workers.")

            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        variable3: d3.sum(d, function(e) { return e[variable3]; }),
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])
                if (kindofworker == "Main") {
                    d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['total_workforce'])
                }
                if (kindofworker == "Marginal") {
                    d.value['percentage'] = ((((d.value['variable2'] + (d.value['variable3'])) * 100) / d.value['total_workforce']))
                }
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }



            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                }

                if (kindofworker == "Main") {
                    percentage_n = (variablen1 * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                }

                if (kindofworker == "Marginal") {
                    percentage_n = ((variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                }

                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);

        }



        function Calculator3(Data, variable, kindofworker) {


            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = parseInt(d['DistrictCode'])
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })


            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0
                var total_population = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    percentage = +Data[id_no - 1][variable]

                    if (kindofworker == "Main") {
                        population = +Data[id_no - 1]['MainWorkers2011']

                        variablevalue = variablevalue + ((percentage) * population)
                        total_population = total_population + (+Data[id_no - 1]['MainWorkers2011'])

                    } else if (kindofworker = "Marginal") {
                        population = +Data[id_no - 1]['MarginalWorkers2011']
                        variablevalue = variablevalue + ((percentage) * population)
                        total_population = total_population + (+Data[id_no - 1]['MarginalWorkers2011'])
                    }

                }
                percentage_n = variablevalue / total_population

                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);


        }


        function Calculator4(Data, variable, total) {

            variable1 = variable
            variable2 = total;

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        total: +total
                    };
                })
                .entries(newData);

            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / variable2)
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablevalue = variablevalue + districtDatabyDistrict[id_no - 1].value['variable1']
                }
                percentage_n = (variablevalue * 100) / total
                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);


        }

        function Calculator5(Data, variable, kindofworker) {

            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#d7191c", "#fdae61", "#a6d96a", "#1a9641"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = d.DistrictCode
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }



            var var2011;
            var var2001;
            if (variable == "PPChangeAgriculture") {
                var2001 = 'Agriculture2001'
                var2011 = 'Agriculture2011'
            }

            if (variable == "PPChangeinManufacturing") {
                var2001 = 'Manufacturing2001'
                var2011 = 'Manufacturing2011'
            }

            if (variable == "PPChangeinConstruction") {
                var2001 = 'Construction2001'
                var2011 = 'Construction2011'
            }

            if (variable == "PPChangeinWholesale") {
                var2001 = 'WholesaleRetail2001'
                var2011 = 'WholesaleRetail2011'
            }

            if (variable == "PPChangeinServices") {
                var2001 = 'Services2001'
                var2011 = 'Services2011'
            }

            if (variable == "PPChangeinMain") {
                var2001 = 'PerMainWorkers2001'
                var2011 = 'PerMainWorkers2011'
            }
            if (variable == "PPChangeinMainMale") {
                var2001 = 'PerMainMale2001'
                var2011 = 'PerMainMale2011'
            }
            if (variable == "PPChangeinMainFemale") {
                var2001 = 'PerMainFemale2001'
                var2011 = 'PerMainFemale2011'
            }

            if (variable == "PPChangeinMarginal") {
                var2001 = 'PerMarginalWorkers2001'
                var2011 = 'PerMarginalWorkers2011'
            }
            if (variable == "PPChangeinMarginalMale") {
                var2001 = 'PerMarginalMale2001'
                var2011 = 'PerMarginalMale2011'
            }
            if (variable == "PPChangeinMarginalFemale") {
                var2001 = 'PerMarginalFemale2001'
                var2011 = 'PerMarginalFemale2011'
            }



            function UrbanAggCalculator(city) {

                lengthofids = city.length
                var variable2011 = 0
                var variable2001 = 0
                var total2001 = 0
                var total2011 = 0
                var variable1 = 0
                var variable2 = 0
                for (item = 0; item < (lengthofids); item++) {

                    id_no = city[item]

                    if (kindofworker == "Main") {

                        variable2011 = +(Data[id_no - 1]['MainWorkers2011'] * Data[id_no - 1][var2011])
                        total2011 = total2011 + (+Data[id_no - 1]['MainWorkers2011'])
                        variable1 = variable1 + variable2011
                        if (id_no == 87 || id_no == 89) {
                            variable2001 = 0
                            variable2 = variable2 + variable2001
                            total2001 = total2001
                        } else {
                            variable2001 = (Data[id_no - 1]['MainWorkersTotal2001'] * Data[id_no - 1][var2001])
                            variable2 = variable2 + variable2001
                            total2001 = total2001 + (+Data[id_no - 1]['MainWorkersTotal2001'])
                        }


                    }

                    if (kindofworker == "Marginal") {

                        variable2011 = +(Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2011])

                        total2011 = total2011 + (+Data[id_no - 1]['MarginalWorkers2011'])
                        variable1 = variable1 + variable2011
                        if (id_no == 87 || id_no == 89) {
                            variable2001 = 0
                            variable2 = variable2 + variable2001
                            total2001 = total2001
                        } else {
                            variable2001 = (Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2001])
                            variable2 = variable2 + variable2001
                            total2001 = total2001 + (+Data[id_no - 1]['MarginalWorkers2011'])
                        }

                    }

                }

                percentage1 = (variable1 / total2011)
                percentage2 = (variable2 / total2001)


                percentage_n = percentage1 - percentage2
                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);


        }

        function Calculator6(Data, variable) {
            variable1 = variable
            variable2 = "Total_Workers_Main"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; })
                    };
                })
                .entries(newData);


            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / (d.value['variable2']))
            })



            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                }

                percentage_n = (variablen1 * 100) / (variablen2).toFixed(2);
                return percentage_n;

            }




            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);



        }




        function Calculator10(Data,sex) {



            if(sex=="Total"){
                var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        Total_Cultivators_Main: d3.sum(d, function(e) { return e['Total_Cultivators_Main']; }),
                        Total_Labourers_Main: d3.sum(d, function(e) { return e['Total_Labourers_Main']; }),
                        Total_Forestry_Main: d3.sum(d, function(e) { return e['Total_Forestry_Main']; }),
                        Total_B_Main: d3.sum(d, function(e) { return e['Total_B_Main']; }),
                        Total_C_HHI_Main: d3.sum(d, function(e) { return e['Total_C_HHI_Main']; }),
                        Total_C_NonHHI_Main: d3.sum(d, function(e) { return e['Total_C_NonHHI_Main']; }),
                        Total_DE_Main: d3.sum(d, function(e) { return e['Total_DE_Main']; }),
                        Total_F_Main: d3.sum(d, function(e) { return e['Total_F_Main']; }),
                        Total_G_HHI_Main: d3.sum(d, function(e) { return e['Total_G_HHI_Main']; }),
                        Total_G_NonHHI_Main: d3.sum(d, function(e) { return e['Total_G_NonHHI_Main']; }),
                        Total_H_Main: d3.sum(d, function(e) { return e['Total_H_Main']; }),
                        Total_I_Main: d3.sum(d, function(e) { return e['Total_I_Main']; }),
                        Total_J_HHI_Main: d3.sum(d, function(e) { return e['Total_J_HHI_Main']; }),
                        Total_J_NonHHI_Main: d3.sum(d, function(e) { return e['Total_J_NonHHI_Main']; }),
                        Total_KM_Main: d3.sum(d, function(e) { return e['Total_KM_Main']; }),
                        Total_NO_Main: d3.sum(d, function(e) { return e['Total_NO_Main']; }),
                        Total_PQ_Main: d3.sum(d, function(e) { return e['Total_PQ_Main']; }),
                        Total_RU_HHI_Main: d3.sum(d, function(e) { return e['Total_RU_HHI_Main']; }),
                        Total_RU_NonHHI_Main: d3.sum(d, function(e) { return e['Total_RU_NonHHI_Main']; }),
                    }
                })
                .entries(Data);
            }

            if(sex="Male"){
                 var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        Male_Cultivators_Main: d3.sum(d, function(e) { return e['Male_Cultivators_Main']; }),
                        Male_Labourers_Main: d3.sum(d, function(e) { return e['Male_Labourers_Main']; }),
                        Male_Forestry_Main: d3.sum(d, function(e) { return e['Male_Forestry_Main']; }),
                        Male_B_Main: d3.sum(d, function(e) { return e['Male_B_Main']; }),
                        Male_C_HHI_Main: d3.sum(d, function(e) { return e['Male_C_HHI_Main']; }),
                        Male_C_NonHHI_Main: d3.sum(d, function(e) { return e['Male_C_NonHHI_Main']; }),
                        Male_DE_Main: d3.sum(d, function(e) { return e['Male_DE_Main']; }),
                        Male_F_Main: d3.sum(d, function(e) { return e['Male_F_Main']; }),
                        Male_G_HHI_Main: d3.sum(d, function(e) { return e['Male_G_HHI_Main']; }),
                        Male_G_NonHHI_Main: d3.sum(d, function(e) { return e['Male_G_NonHHI_Main']; }),
                        Male_H_Main: d3.sum(d, function(e) { return e['Male_H_Main']; }),
                        Male_I_Main: d3.sum(d, function(e) { return e['Male_I_Main']; }),
                        Male_J_HHI_Main: d3.sum(d, function(e) { return e['Male_J_HHI_Main']; }),
                        Male_J_NonHHI_Main: d3.sum(d, function(e) { return e['Male_J_NonHHI_Main']; }),
                        Male_KM_Main: d3.sum(d, function(e) { return e['Male_KM_Main']; }),
                        Male_NO_Main: d3.sum(d, function(e) { return e['Male_NO_Main']; }),
                        Male_PQ_Main: d3.sum(d, function(e) { return e['Male_PQ_Main']; }),
                        Male_RU_HHI_Main: d3.sum(d, function(e) { return e['Male_RU_HHI_Main']; }),
                        Male_RU_NonHHI_Main: d3.sum(d, function(e) { return e['Male_RU_NonHHI_Main']; }),
                    }
                })
                .entries(Data);

            }

            if(sex=="Female"){
                 var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        Female_Cultivators_Main: d3.sum(d, function(e) { return e['Female_Cultivators_Main']; }),
                        Female_Labourers_Main: d3.sum(d, function(e) { return e['Female_Labourers_Main']; }),
                        Female_Forestry_Main: d3.sum(d, function(e) { return e['Female_Forestry_Main']; }),
                        Female_B_Main: d3.sum(d, function(e) { return e['Female_B_Main']; }),
                        Female_C_HHI_Main: d3.sum(d, function(e) { return e['Female_C_HHI_Main']; }),
                        Female_C_NonHHI_Main: d3.sum(d, function(e) { return e['Female_C_NonHHI_Main']; }),
                        Female_DE_Main: d3.sum(d, function(e) { return e['Female_DE_Main']; }),
                        Female_F_Main: d3.sum(d, function(e) { return e['Female_F_Main']; }),
                        Female_G_HHI_Main: d3.sum(d, function(e) { return e['Female_G_HHI_Main']; }),
                        Female_G_NonHHI_Main: d3.sum(d, function(e) { return e['Female_G_NonHHI_Main']; }),
                        Female_H_Main: d3.sum(d, function(e) { return e['Female_H_Main']; }),
                        Female_I_Main: d3.sum(d, function(e) { return e['Female_I_Main']; }),
                        Female_J_HHI_Main: d3.sum(d, function(e) { return e['Female_J_HHI_Main']; }),
                        Female_J_NonHHI_Main: d3.sum(d, function(e) { return e['Female_J_NonHHI_Main']; }),
                        Female_KM_Main: d3.sum(d, function(e) { return e['Female_KM_Main']; }),
                        Female_NO_Main: d3.sum(d, function(e) { return e['Female_NO_Main']; }),
                        Female_PQ_Main: d3.sum(d, function(e) { return e['Female_PQ_Main']; }),
                        Female_RU_HHI_Main: d3.sum(d, function(e) { return e['Female_RU_HHI_Main']; }),
                        Female_RU_NonHHI_Main: d3.sum(d, function(e) { return e['Female_RU_NonHHI_Main']; }),
                    }
                })
                .entries(Data);
            }
            

            // var items = Data.map(post => post[variable]);


            var colourScale = d3.scaleOrdinal().domain(["Agricultural Labourers",
                "Cultivators",
                "Manufacturing",
                "Construction",
                "Trade",
                "Education and Health",
                "Administration and Defence",
                "Plantation etc",
                "Mining",
                "Other Services",
                "Transportation"
            ]).range(["b29f34",
                "789b3e",
                "637474",
                "33464d",
                "e58a2e",
                "734785",
                "23597c",
                "54603a",
                "161819",
                "bc352a",
                "ffffff"
            ]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                code=d.key
                item = d.value
                max=Object.keys(item).reduce((a, b) => item[a] > item[b] ? a : b);
                if(max=="Total_Cultivators_Main" || max=="Male_Cultivators_Main" || max=="Female_Cultivators_Main" )
                {
                    max="Cultivators"
                }
                if(max=="Total_Labourers_Main"|| max=="Male_Labourers_Main" || max=="Female_Labourers_Main")
                {
                    max="Agricultural Labourers"
                }
                if(max=="Total_Forestry_Main"|| max=="Male_Forestry_Main" || max=="Female_Forestry_Main")
                {
                    max="Plantation, Livestock, Forestry"
                }
                if(max=="Total_B_Main"|| max=="Male_B_Main" || max=="Female_B_Main")
                {
                    max="Mining"
                }
                if(max=="Total_C_HHI_Main"|| max=="Male_C_HHI_Main" || max=="Female_C_HHI_Main")
                {
                    max="Manufacturing"
                }
                if(max=="Total_C_NonHHI_Main"|| max=="Male_C_NonHHI_Main" || max=="Female_C_NonHHI_Main")
                {
                    max="Manufacturing"
                }
                if(max=="Total_F_Main"|| max=="Male_F_Main" || max=="Female_F_Main")
                {
                    max="Construction"
                }
                if(max=="Total_H_Main"|| max=="Male_H_Main" || max=="Female_H_Main")
                {
                    max="Transportation"
                }
                if(max=="Total_G_HHI_Main"|| max=="Male_G_HHI_Main" || max=="Female_G_HHI_Main")
                {
                    max="Trade"
                }
                if(max=="Total_G_NonHHI_Main"|| max=="Male_G_NonHHI_Main" || max=="Female_G_NonHHI_Main")
                {
                    max="Trade"
                }
                if(max=="Total_NO_Main"|| max=="Male_NO_Main" || max=="Female_NO_Main")
                {
                    max="Administration and Defence"
                }
                 if(max=="Total_PQ_Main"|| max=="Male_PQ_Main" || max=="Female_PQ_Main")
                {
                    max="Education and Health"
                }
                if(max=="Total_RU_HHI_Main"|| max=="Male_RU_HHI_Main" || max=="Female_RU_HHI_Main")
                {
                    max="Other Services"
                }
                 if(max=="Total_RU_NonHHI_Main"|| max=="Male_RU_NonHHI_Main" || max=="Female_RU_NonHHI_Main")
                {
                    max="Other Services"
                }
                districtData[code] = max;
                var colourState = colourScale(max);
                d3.select("#b" + code).transition().duration(1000).style("fill", colourState);
            })

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,20)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Industry")
                .scale(colourScale)

            svg.select(".legendQuant")
                .call(legend);


            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode]);
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })


        }


        function Calculator11(Data) {

            d3.select("#notes").text("Labour Force is defined as the sum of all Main workers, Marginal workers and Job seeking Non Workers")

            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            variable4 = "Total_Person_Nonworkers_Seeking"
            variable5 = variable1 + variable2 + variable3 + variable4

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        variable3: d3.sum(d, function(e) { return e[variable3]; }),
                        variable4: d3.sum(d, function(e) { return e[variable4]; })
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4'])
                d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['total_workforce'])
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })

            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }



            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                }

                percentage_n = (variablen1 * 100) / (variablen1 + variablen2 + variablen3 + variablen4).toFixed(2);
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);

        }

        function Calculator12(Data) {

            d3.select("#notes").text("Labour Force is defined as the sum of all Main workers, Marginal workers and Job seeking Non Workers")

            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            variable4 = "Total_Person_Nonworkers_Seeking"
            variable5 = variable1 + variable2 + variable3 + variable4

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        variable3: d3.sum(d, function(e) { return e[variable3]; }),
                        variable4: d3.sum(d, function(e) { return e[variable4]; })
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4'])
                d.value['percentage'] = (((d.value['variable2']) + (d.value['variable3']) * 100) / d.value['total_workforce'])
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }



            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                }

                percentage_n = ((variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3 + variablen4).toFixed(2);
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);

        }

        function Calculator13(Data, domain) {


            if (domain == "Agriculture") {

                variable1 = "Total_Cultivators_Main"
                variable2 = "Total_Labourers_Main"
                variable3 = "Total_Forestry_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                            variable3: d3.sum(d, function(e) { return e[variable3]; }),
                            variable4: d3.sum(d, function(e) { return e[variable4]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Non-Agricultural Industries") {

                variable1 = "Total_Cultivators_Main"
                variable2 = "Total_Labourers_Main"
                variable3 = "Total_Forestry_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                            variable3: d3.sum(d, function(e) { return e[variable3]; }),
                            variable4: d3.sum(d, function(e) { return e[variable4]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = 100 - ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Manufacturing") {

                variable1 = "Total_B_Main"
                variable2 = "Total_C_HHI_Main"
                variable3 = "Total_C_NonHHI_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                            variable3: d3.sum(d, function(e) { return e[variable3]; }),
                            variable4: d3.sum(d, function(e) { return e[variable4]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Wholesale and Retail Trade") {

                variable1 = "Total_G_HHI_Main"
                variable2 = "Total_G_NonHHI_Main"
                variable3 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                            variable3: d3.sum(d, function(e) { return e[variable3]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']))) * 100) / d.value['variable3']
                })

            }

            if (domain == "Construction") {

                variable1 = "Total_F_Main"
                variable2 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1'])) * 100) / d.value['variable2'])
                })

            }

            if (domain == "Services") {

                variable1 = "Total_DE_Main"
                variable2 = "Total_G_HHI_Main"
                variable3 = "Total_G_NonHHI_Main"
                variable4 = "Total_H_Main"
                variable5 = "Total_I_Main"
                variable6 = "Total_J_HHI_Main"
                variable7 = "Total_J_NonHHI_Main"
                variable8 = "Total_KM_Main"
                variable9 = "Total_NO_Main"
                variable10 = "Total_PQ_Main"
                variable11 = "Total_RU_HHI_Main"
                variable12 = "Total_RU_NonHHI_Main"
                variable13 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) { return +d.District_Code; })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) { return e[variable1]; }),
                            district: d[0].District_Code,
                            variable2: d3.sum(d, function(e) { return e[variable2]; }),
                            variable3: d3.sum(d, function(e) { return e[variable3]; }),
                            variable4: d3.sum(d, function(e) { return e[variable4]; }),
                            variable5: d3.sum(d, function(e) { return e[variable5]; }),
                            variable6: d3.sum(d, function(e) { return e[variable6]; }),
                            variable7: d3.sum(d, function(e) { return e[variable7]; }),
                            variable8: d3.sum(d, function(e) { return e[variable8]; }),
                            variable9: d3.sum(d, function(e) { return e[variable9]; }),
                            variable10: d3.sum(d, function(e) { return e[variable10]; }),
                            variable11: d3.sum(d, function(e) { return e[variable11]; }),
                            variable12: d3.sum(d, function(e) { return e[variable12]; }),
                            variable13: d3.sum(d, function(e) { return e[variable13]; }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4']) + (d.value['variable5']) + (d.value['variable6']) + (d.value['variable7']) + (d.value['variable8']) + (d.value['variable9']) + (d.value['variable10']) + (d.value['variable11']) + (d.value['variable12'])) * 100) / d.value['variable13'])
                })

            }

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#BD3884");
                count = count + 1

            }



            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                var variablen5 = 0
                var variablen6 = 0
                var variablen7 = 0
                var variablen8 = 0
                var variablen9 = 0
                var variablen10 = 0
                var variablen11 = 0
                var variablen12 = 0
                var variablen13 = 0

                if (domain == "Agriculture" || domain == "Manufacturing") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return percentage_n;


                }
                if (domain == "Services") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                        variablen5 = variablen5 + (districtDatabyDistrict[id_no - 1].value['variable5'])
                        variablen6 = variablen6 + (districtDatabyDistrict[id_no - 1].value['variable6'])
                        variablen7 = variablen7 + (districtDatabyDistrict[id_no - 1].value['variable7'])
                        variablen8 = variablen8 + (districtDatabyDistrict[id_no - 1].value['variable8'])
                        variablen9 = variablen9 + (districtDatabyDistrict[id_no - 1].value['variable9'])
                        variablen10 = variablen10 + (districtDatabyDistrict[id_no - 1].value['variable10'])
                        variablen11 = variablen11 + (districtDatabyDistrict[id_no - 1].value['variable11'])
                        variablen12 = variablen12 + (districtDatabyDistrict[id_no - 1].value['variable12'])
                        variablen13 = variablen13 + (districtDatabyDistrict[id_no - 1].value['variable13'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3 + variablen4 + variablen5 + variablen6 + variablen7 + variablen8 + variablen9 + variablen10 + variablen11 + variablen12) * 100) / (variablen13).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Wholesale and Retail Trade") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    }

                    percentage_n = ((variablen1 + variablen2) * 100) / (variablen3).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Non-Agricultural Industries") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return 100 - percentage_n;


                }
            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);



        }




        function Main_Workers() {

            worker_keys = ["Percentage of Total Workforce", "Percentage of Labour Force", "Regular Workers by Industry", "Largest Employer"];



            d3.select('#datagroups')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {


                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons").style("background", "transparent")
                d3.select(this).style("background", backgroundColour)
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".ageButtons").remove()
                d3.selectAll(".annotation-group").remove();
                d3.selectAll(".legendQuant").remove()




                if (datapoint == "Percentage of Total Workforce") {

                    newData = FinalData.filter(function(d) {
                        return (d.Age == "Total")
                    });

                    Calculator(newData, "Main");


                    age_keys = ["Child workers (<15 years)", "15-59 years", "25-59 years", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            Calculator(newData, "Main");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            Calculator(newData, "Main");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            Calculator(newData, "Main");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            Calculator(newData, "Main");

                        }

                    }

                }


                if (datapoint == "Percentage of Labour Force") {

                    newData = FinalData.filter(function(d) {
                        return (d.Age == "Total")
                    });

                    Calculator11(newData);


                    age_keys = ["Child workers (<15 years)", "15-59 years", "25-59 years", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            Calculator11(newData);

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            Calculator11(newData);

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            Calculator11(newData);

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            Calculator11(newData);

                        }
                    }

                }



                if (datapoint == "Regular Workers by Industry") {
                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".categoryButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()

                    category_keys = ["Farm",
                        "Manufacturing",
                        "Trade",
                        "Construction",
                        "Services", "Non-Farm Industries",
                    ];


                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(category_keys)
                        .enter()
                        .append("button")
                        .on("click", categoryClick)
                        .attr("id", d => d)
                        .attr("class", "categoryButtons")
                        .html(function(d) {
                            return d;
                        })


                    function categoryClick(domain) {
                        d3.selectAll(".categoryButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)
                        d3.selectAll(".dataButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".ageButtons").remove()

                        age_keys = ["Child workers (<15 years)", "15-59 years", "25-59 years", "Senior workers (>60 years)"];


                        var select = d3.select('#ageviews')
                            .append('select')
                            .attr('class', 'ageButtons')
                            .on('change', parameterClick)

                        var options = select
                            .selectAll('option')
                            .data(age_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        var domain = domain
                        var dropdown = "dropdown1"

                        if (domain == "Agriculture") {
                            industry_keys = ["Cultivators", "Farm Labourers", "Plantation etc"]
                        }
                        if (domain == "Manufacturing") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)"]
                        }
                        if (domain == "Trade") {
                            industry_keys = ["Trade(Household)", "Trade(Non Household)"]
                        }
                        if (domain == "Services") {
                            industry_keys = ["Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }
                        if (domain == "Non-Farm Industries") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)", "Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }




                        var select = d3.select('#detailedindustries')
                            .append('select')
                            .attr('class', 'industryButtons')
                            .on('change', industryClick)

                        var options = select
                            .selectAll('option')
                            .data(industry_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        function industryClick() {

                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "Total"))
                            });

                            dropdown = "dropdown2"
                            datapoint = d3.select(this).property('value')


                            if (datapoint == "Cultivators") {
                                variable = "Total_Cultivators_Main"

                            }
                            if (datapoint == "Farm Labourers") {
                                variable = "Total_Labourers_Main"

                            }
                            if (datapoint == "Plantation etc") {
                                variable = "Total_Forestry_Main"

                            }

                            if (datapoint == "Mining") {
                                variable = "Total_B_Main"

                            }
                            if (datapoint == "Manufacturing (Household)") {
                                variable = "Total_C_HHI_Main"

                            }
                            if (datapoint == "Manufacturing (Non Household)") {
                                variable = "Total_C_NonHHI_Main"
                            }

                            if (datapoint == "Trade(Household)") {
                                variable = "Total_G_HHI_Main"

                            }
                            if (datapoint == "Trade(Non Household)") {
                                variable = "Total_G_NonHHI_Main"

                            }
                            if (datapoint == "Utilities") {
                                variable = "Total_DE_Main"

                            }
                            if (datapoint == "Hospitality") {
                                variable = "Total_I_Main"

                            }
                            if (datapoint == "Transportation") {
                                variable = "Total_H_Main"

                            }
                            if (datapoint == "IT (Household)") {
                                variable = "Total_J_HHI_Main"
                            }

                            if (datapoint == "IT (Non Household)") {
                                variable = "Total_J_NonHHI_Main"
                            }

                            if (datapoint == "Finance") {
                                variable = "Total_KM_Main"

                            }
                            if (datapoint == "Administration and Defence") {
                                variable = "Total_NO_Main"

                            }
                            if (datapoint == "Education and Health") {
                                variable = "Total_PQ_Main"

                            }
                            if (datapoint == "Other Services (Household)") {
                                variable = "Total_RU_HHI_Main"

                            }
                            if (datapoint == "Other Services (Non Household)") {
                                variable = "Total_RU_NonHHI_Main"

                            }


                            Calculator6(newData, variable)

                        }

                        function parameterClick() {
                            datapoint = d3.select(this).property('value')
                            if (datapoint == "Child workers (<15 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "5-9" || d.Age == "10-14"))
                                });

                                if (dropdown == "dropdown1") {
                                    Calculator13(newData, domain);
                                } else {
                                    Calculator6(newData, variable);
                                }

                            }

                            if (datapoint == "15-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    Calculator13(newData, domain);
                                } else {
                                    Calculator6(newData, variable);
                                }


                            }

                            if (datapoint == "25-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    Calculator13(newData, domain);
                                } else {
                                    Calculator6(newData, variable);
                                }


                            }

                            if (datapoint == "Senior workers (>60 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                                });


                                if (dropdown == "dropdown1") {
                                    Calculator13(newData, domain);
                                } else {
                                    Calculator6(newData, variable);
                                }


                            }

                        }

                    }

                }

                if (datapoint == "Largest Employer") {

                    d3.selectAll(".categoryButtons").style("background", "transparent")
                    d3.select(this).style("background", backgroundColour)
                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()

                    age_keys = ["Child workers (<15 years)", "15-59 years", "25-59 years", "Senior workers (>60 years)"];


                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    sex_keys=["Total","Male","Female"]


                    sex="Total"

                    var select = d3.select('#sexviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', sexClick)

                    var options = select
                        .selectAll('option')
                        .data(sex_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    function sexClick(){
                        datapoint=d3.select(this).property('value')
                        sex = datapoint
                    }  




                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            Calculator10(newData,sex);

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            Calculator10(newData,sex);

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            Calculator10(newData,sex);

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            Calculator10(newData,sex);

                        }
                    }

                }


                if (datapoint == "Changes since 2001") {

                    d3.select("#notes").text("For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")


                    d3.select('#ageviews')
                        .selectAll("path")
                        .data(age_keys)
                        .enter()
                        .append("button")
                        .on("click", fileChoice)
                        .attr("id", d => d)
                        .attr("class", "ageButtons")
                        .html(function(d) {
                            return d;
                        })

                    var file;

                    function fileChoice(datapoint) {
                        d3.selectAll(".ageButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)

                        if (datapoint == "Total") {
                            file = "B4_complete_aggregate.csv"
                            ageFUNCTION(file);

                        }
                        if (datapoint == "15-59 years") {
                            file = "B4_complete_aggregate_15.csv"
                            ageFUNCTION(file);

                        }
                        if (datapoint == "25-59 years") {
                            file = "B4_complete_aggregate_25.csv"
                            ageFUNCTION(file);

                        }
                    }



                    function ageFUNCTION(file) {

                        d3.selectAll(".dataButtons").remove()
                        d3.selectAll(".categoryButtons").remove()
                        d3.selectAll(".industryButtons").remove()



                        d3.csv(file, function(error, Data) {



                            worker_keys = ["Percentage Points change in Proportion of Regular Workers", "Percentage Points change in Proportion of Regular Male Workers", "Percentage Points change in Proportion of Regular Female Workers",
                                "Percentage Points change in Agriculture",
                                "Percentage Points change in Manufacturing",
                                "Percentage Points change in Construction",
                                "Percentage Points change in Wholesale",
                                "Percentage Points change in Services"
                            ];
                            d3.select('#dataparameters')
                                .selectAll("path")
                                .data(worker_keys)
                                .enter()
                                .append("button")
                                .on("click", parameterClick)
                                .attr("id", d => d)
                                .attr("class", "dataButtons")
                                .html(function(d) {
                                    return d;
                                })


                            function parameterClick(datapoint) {
                                d3.selectAll(".dataButtons").style("background", "transparent")
                                d3.select(this).style("background", backgroundColour)
                                if (datapoint == "Percentage Points change in Proportion of Regular Workers") {

                                    Calculator5(Data, "PPChangeinMain", "Main");

                                }

                                if (datapoint == "Percentage Points change in Proportion of Regular Male Workers") {

                                    Calculator5(Data, "PPChangeinMainMale", "Main");

                                }
                                if (datapoint == "Percentage Points change in Proportion of Regular Female Workers") {

                                    Calculator5(Data, "PPChangeinMainFemale", "Main");

                                }
                                if (datapoint == "Percentage change in Female participation") {

                                    Calculator5(Data, "PPChangeinFemaleParticipation", "Main");

                                }
                                if (datapoint == "Percentage Points change in Agriculture") {

                                    Calculator5(Data, "PPChangeAgriculture", "Main");

                                }
                                if (datapoint == "Percentage Points change in Manufacturing") {

                                    Calculator5(Data, "PPChangeinManufacturing", "Main");

                                }
                                if (datapoint == "Percentage Points change in Wholesale") {

                                    Calculator5(Data, "PPChangeinWholesale", "Main");

                                }
                                if (datapoint == "Percentage Points change in Services") {

                                    Calculator5(Data, "PPChangeinServices", "Main");

                                }
                                if (datapoint == "Percentage Points change in Construction") {

                                    Calculator5(Data, "PPChangeinConstruction", "Main");

                                }

                                if (datapoint == "Percentage Point Change in Non Agricultural Work") {

                                    Calculator5(Data, "PPChangeinNonAgriculturalWork", "Main");

                                }



                            }


                        })
                    }

                }


            }

        }
    }
    </script>
</body>

</html>