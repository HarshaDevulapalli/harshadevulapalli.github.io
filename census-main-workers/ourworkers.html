<!DOCTYPE html>
<html lang="en">

<head>
    <title>How India Works</title>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="india_districts.json" <meta charset="UTF8"></script>
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:300,400,600,900" rel="stylesheet">
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
    <style>
    body {
        font-family: "Fira Sans Extra Condensed", sans-serif;
    }

    h1,
    h2,
    h3,
    h6 {

        text-align: center;
    }

    h1 {
        font-size: 2em;
        font-weight: 900;
    }

    p,
    ul {
        font-weight: 400;
        font-size: 1.25em;
    }

    h3 {
        font-size: 1em;
        font-weight: 600;
    }

    h4,
    h5,
    .label {
        font-size: 0.8em;
        font-weight: 400;
        text-align: left;
    }

    .stateLabel {
        font-size: 0.7em;
        font-weight: 400;

    }

    }

    h6 {
        color: #f49416;
        font-size: 0.8em;
        font-weight: 300;
    }

    path.hover {
        stroke-width: 1.25px;
        opacity: 1;
    }

    path {
        stroke-width: 0.75px;
        opacity: 0.9;
    }

    button {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
        text-decoration: underline;
    }

    #centered {
        width: 500px;
        text-align: left;
        margin: 0 auto;
    }

    .dataButtons {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
        text-decoration: underline;
    }

    .toolTip {
        position: absolute;
        display: none;
        min-width: 40px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1.5px solid #000000;
        padding: 10px;
        text-align: center;
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 400;
        font-size: 0.8em;
    }

    .annotation-group {
        pointer-events: none
    }

    div {
        margin: 5px;
    }
    </style>
</head>

<body>
    <div id="controls" title="As defined in the Census" align="center" style="font-size : 1.5em"></div>
    <div id="workerkeys" align="center" style="font-size : 1.2em"></div>
    <div id="categoryparameters" align="center"></div>
    <div id="industryparameters" align="center"></div>
    <div id="dataparameters" align="center"></div>
    <h3> Hover on a district to see how it fares. </h3>
    <div id="canvas" align="center"></div>
    <h3> Notes </h3>
    <div id="notes" align="center"></div>
    <script>
    var width = 800;
    var height = 800;

    const zoom = d3.zoom()
        .scaleExtent([1, 3])
        .translateExtent([
            [0, 0],
            [width, height]
        ])
        .extent([
            [0, 0],
            [width, height]
        ])
        .on("zoom", zoomed);

    // Create SVG
    var svg = d3.select("#canvas")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("align", "center");
    // .call(zoom);

    function zoomed() {
        svg.attr("transform", d3.event.transform);
    }

    var geoProjection = d3.geoMercator()
        .scale(1200)
        .center([83, 23])
        .translate([width / 2, height / 2]);

    var geoPath = d3.geoPath()
        .projection(geoProjection);

    d3.queue()
        .defer(d3.json, "india_districts.json")
        .defer(d3.csv, "mergedTotal_B1.csv")
        .defer(d3.json, "india.json")
        .await(ready);

    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    var Hyderabad = [535, 536, 537, 539]
    var Bangalore = [572, 583, 584]
    var Chennai = [602, 603, 604]
    var Kolkata = [336, 337, 338, 341, 342, 343]
    var Mumbai = [517, 518, 519, 520, 521]
    var Delhi = [74, 75, 77, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 104, 105, 133, 138, 139, 140, 141, 142]


    function Annotate(numbers) {
        d3.selectAll(".annotation-group").remove();

        const annotations = [{
                //below in makeAnnotations has type set to d3.annotationLabel
                //you can add this type value below to override that default
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[5].toFixed(2) + " percent",
                    title: "Delhi UA Region",
                    wrap: 300
                },

                //settings for the subject, in this case the circle radius
                subject: {
                    radius: 25

                },
                x: 275,
                y: 270,
                dy: -75,
                dx: -75
            },
            {
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[4].toFixed(2) + " percent",
                    title: "Mumbai UA Region",
                    wrap: 100
                },

                subject: {
                    radius: 20

                },
                x: 195,
                y: 490,
                dy: 75,
                dx: -75
            },
            {
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[0].toFixed(2) + " percent",
                    title: "Hyderabad UA Region",
                    wrap: 100
                },

                subject: {
                    radius: 15

                },
                x: 300,
                y: 527,
                dy: 0,
                dx: 100
            },
            {
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[3].toFixed(2) + " percent",
                    title: "Kolkata UA Region",
                    wrap: 100
                },

                subject: {
                    radius: 20

                },
                x: 515,
                y: 410,
                dy: 70,
                dx: 70
            },
            {
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[2].toFixed(2) + " percent",
                    title: "Chennai UA Region",
                    wrap: 100
                },

                subject: {
                    radius: 15

                },
                x: 335,
                y: 625,
                dy: 50,
                dx: 50
            },
            {
                type: d3.annotationCalloutCircle,
                note: {
                    label: numbers[1].toFixed(2) + " percent",
                    title: "Bangalore UA Region",
                    wrap: 100
                },

                subject: {
                    radius: 15

                },
                x: 285,
                y: 620,
                dy: 100,
                dx: -100
            }
        ].map(function(d) { d.color = "#000000"; return d })

        const makeAnnotations = d3.annotation()
            .type(d3.annotationLabel)
            .annotations(annotations)

        d3.select("svg")
            .append("g")
            .attr("class", "annotation-group")
            .call(makeAnnotations)
    }

    function ready(error, india, Data, indiaState) {

        if (error) throw error;

        var allStates = svg.append("g")
            .selectAll("path")
            .data(topojson.feature(indiaState, indiaState.objects.india).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .style("stroke", "#000000")
            .style("fill", "transparent")
            .style("stroke-width", "1.5px")

        var allDistricts = svg.append("g")
            .attr("id", "allDistricts")
            .selectAll("path")
            .data(topojson.feature(india, india.objects.india_district).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .attr("class", "district")
            .attr("id", function(d) {
                return ("b" + d.properties.censuscode)
            })
            .style("fill", "#f0f0f0")
            .style("stroke", "transparent")
            .style("stroke-width", '2px')
            .style("opacity", 0.85)

        const filterKeys = ["Main Workers", "Marginal Workers"]

        d3.select('#controls')
            .selectAll("path")
            .data(filterKeys)
            .enter()
            .append("button")
            .on("click", buttonClick)
            .attr("id", d => d)
            .attr("class", "workerButtons")
            .html(function(d) {
                return d;
            })


        backgroundColour = "#fde8e8"

        function buttonClick(datapoint) {
            d3.selectAll(".workerButtons").style("background", "transparent")
            d3.select(this).style("background", backgroundColour)
            d3.selectAll(".dataButtons").remove()
            d3.selectAll(".parameterButtons").remove()
            d3.selectAll(".categoryButtons").remove()
            d3.selectAll(".industryButtons").remove()
            d3.selectAll(".annotation-group").remove();


            if (datapoint == "Main Workers") {
                Main_Workers()
            }

            if (datapoint == "Marginal Workers") {
                Marginal_Workers()
            }

        }

        function drawLegendandTooltip(colourScale, districtData) {

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,50)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Legend (in %)")
                .scale(colourScale)

            svg.select(".legendQuant")
                .call(legend);

            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + "<br>" + districtData[d.properties.censuscode].toFixed(2));
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })

        }



        function Calculator(Data) {

            d3.select("#notes").text("Total Workforce is defined as the sum of all Main and Marginal workers.")

            variable1 = "Total_Main_Workers"
            variable2 = "Total_Marginal_Workers_3months"
            variable3 = "Total_Marginal_Workers_6months"
            variable4 = variable1 + variable2 + variable3

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        variable3: d3.sum(d, function(e) { return e[variable3]; }),
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])
                d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['total_workforce'])
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })



            function CityCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                }

                percentage_n = (variablen1 * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                return percentage_n;

            }


            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);

        }



        function Calculator3(Data, variable) {


            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = parseInt(d['DistrictCode'])
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            function CityCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0
                var total_population = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    percentage = +Data[id_no - 1][variable]
                    population = +Data[id_no - 1]['MainWorkers2011']
                    variablevalue = variablevalue + ((percentage) * population)
                    total_population = total_population + (+Data[id_no - 1]['MainWorkers2011'])
                }
                percentage_n = variablevalue / total_population
                return percentage_n;

            }

            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);


        }


        function Calculator4(Data, variable, total) {

            variable1 = variable
            variable2 = total;

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        total: +total
                    };
                })
                .entries(newData);

            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / variable2)
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })


            function CityCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablevalue = variablevalue + districtDatabyDistrict[id_no - 1].value['variable1']
                }
                percentage_n = (variablevalue * 100) / total
                return percentage_n;

            }

            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);


        }

        function Calculator5(Data, variable) {

            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#d7191c", "#fdae61", "#a6d96a", "#1a9641"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = d.DistrictCode
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })



            var var2011;
            var var2001;
            if (variable == "PPChangeAgriculture") {
                var2001 = 'Agriculture2001'
                var2011 = 'Agriculture2011'
            }

            if (variable == "PPChangeinManufacturing") {
                var2001 = 'Manufacturing2001'
                var2011 = 'Manufacturing2011'
            }

            if (variable == "PPChangeinConstruction") {
                var2001 = 'Construction2001'
                var2011 = 'Construction2011'
            }

            if (variable == "PPChangeinWholesale") {
                var2001 = 'WholesaleRetail2001'
                var2011 = 'WholesaleRetail2011'
            }

            if (variable == "PPChangeinServices") {
                var2001 = 'Services2001'
                var2011 = 'Services2011'
            }

            if (variable == "PPChangeinMain") {
                var2001 = 'PerMainWorkers2001'
                var2011 = 'PerMainWorkers2011'
            }
            if (variable == "PPChangeinMainMale") {
                var2001 = 'PerMainMale2001'
                var2011 = 'PerMainMale2011'
            }
            if (variable == "PPChangeinMainFemale") {
                var2001 = 'PerMainFemale2001'
                var2011 = 'PerMainFemale2011'
            }



            function CityCalculator(city) {

                lengthofids = city.length
                var variable2011 = 0
                var variable2001 = 0
                var total2001 = 0
                var total2011 = 0
                var variable1 = 0
                var variable2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variable2011 = +(Data[id_no - 1]['MainWorkers2011'] * Data[id_no - 1][var2011])
                    total2011 = total2011 + (+Data[id_no - 1]['MainWorkers2011'])
                    variable1 = variable1 + variable2011
                    if (id_no == 87 || id_no == 89) {
                        variable2001 = 0
                        variable2 = variable2 + variable2001
                        total2001 = total2001
                    } else {
                        variable2001 = (Data[id_no - 1]['MainWorkersTotal2001'] * Data[id_no - 1][var2001])
                        variable2 = variable2 + variable2001
                        total2001 = total2001 + (+Data[id_no - 1]['MainWorkersTotal2001'])
                    }

                }

                percentage1 = (variable1 / total2011)
                percentage2 = (variable2 / total2001)


                percentage_n = percentage2 - percentage1
                return percentage_n;

            }

            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);


        }

        function Calculator6(Data, variable) {
            variable1 = variable
            variable2 = "Total_Workers"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; })
                    };
                })
                .entries(newData);


            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / (d.value['variable2']))
            })



            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })


            function CityCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                }

                percentage_n = (variablen1 * 100) / (variablen2).toFixed(2);
                return percentage_n;

            }




            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);



        }

        function Calculator7(Data) {

            d3.select("#notes").text("Total Workforce is defined as the sum of all Main and Marginal workers.")

            variable1 = "Total_Main_Workers"
            variable2 = "Total_Marginal_Workers_3months"
            variable3 = "Total_Marginal_Workers_6months"
            variable4 = variable1 + variable2 + variable3

            var districtDatabyDistrict = d3.nest()
                .key(function(d) { return +d.District_Code; })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) { return e[variable1]; }),
                        district: d[0].District_Code,
                        variable2: d3.sum(d, function(e) { return e[variable2]; }),
                        variable3: d3.sum(d, function(e) { return e[variable3]; }),
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])
                d.value['percentage'] = ((((d.value['variable2'] + (d.value['variable3'])) * 100) / d.value['total_workforce']))
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#c2e699", "#78c679", "#238443"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })



            function CityCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                }

                percentage_n = ((variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                return percentage_n;

            }


            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);

        }

        function Calculator8(Data, variable) {


            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = parseInt(d['DistrictCode'])
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            function CityCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0
                var total_population = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    percentage = +Data[id_no - 1][variable]
                    population = +Data[id_no - 1]['MarginalWorkers2011']
                    variablevalue = variablevalue + ((percentage) * population)
                    total_population = total_population + (+Data[id_no - 1]['MarginalWorkers2011'])
                }
                percentage_n = variablevalue / total_population
                return percentage_n;

            }

            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);


        }

        function Calculator9(Data, variable) {

            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#d7191c", "#fdae61", "#a6d96a", "#1a9641"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = d.DistrictCode
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);

                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })



            var var2011;
            var var2001;
            if (variable == "PPChangeAgriculture") {
                var2001 = 'Agriculture2001'
                var2011 = 'Agriculture2011'
            }

            if (variable == "PPChangeinManufacturing") {
                var2001 = 'Manufacturing2001'
                var2011 = 'Manufacturing2011'
            }

            if (variable == "PPChangeinConstruction") {
                var2001 = 'Construction2001'
                var2011 = 'Construction2011'
            }

            if (variable == "PPChangeinWholesale") {
                var2001 = 'WholesaleRetail2001'
                var2011 = 'WholesaleRetail2011'
            }

            if (variable == "PPChangeinServices") {
                var2001 = 'Services2001'
                var2011 = 'Services2011'
            }

            if (variable == "PPChangeinMarginal") {
                var2001 = 'PerMarginalWorkers2001'
                var2011 = 'PerMarginalWorkers2011'
            }
            if (variable == "PPChangeinMarginalMale") {
                var2001 = 'PerMarginalMale2001'
                var2011 = 'PerMarginalMale2011'
            }
            if (variable == "PPChangeinMarginalFemale") {
                var2001 = 'PerMarginalFemale2001'
                var2011 = 'PerMarginalFemale2011'
            }



            function CityCalculator(city) {

                lengthofids = city.length
                var variable2011 = 0
                var variable2001 = 0
                var total2001 = 0
                var total2011 = 0
                var variable1 = 0
                var variable2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variable2011 = +(Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2011])

                    total2011 = total2011 + (+Data[id_no - 1]['MarginalWorkers2011'])
                    variable1 = variable1 + variable2011
                    if (id_no == 87 || id_no == 89) {
                        variable2001 = 0
                        variable2 = variable2 + variable2001
                        total2001 = total2001
                    } else {
                        variable2001 = (Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2001])
                        variable2 = variable2 + variable2001
                        total2001 = total2001 + (+Data[id_no - 1]['MarginalWorkers2011'])
                    }

                }

                percentage1 = (variable1 / total2011)
                percentage2 = (variable2 / total2001)


                percentage_n = percentage2 - percentage1
                return percentage_n;

            }


            city_array = [CityCalculator(Hyderabad), CityCalculator(Bangalore), CityCalculator(Chennai), CityCalculator(Kolkata), CityCalculator(Mumbai), CityCalculator(Delhi)]

            drawLegendandTooltip(colourScale, districtData);
            Annotate(city_array);


        }

        function Main_Workers() {
            worker_keys = ["Percentage of Total Workforce", "Main Workers by Industry", "Changes since 2001"];



            d3.select('#workerkeys')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {


                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons").style("background", "transparent")
                d3.select(this).style("background", backgroundColour)
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".annotation-group").remove();





                if (datapoint == "Percentage of Total Workforce") {



                    newData = Data.filter(function(d) {
                        return (d.Age_Group == "Total" && d.Rural_or_Urban == "Total")
                    });

                    Calculator(newData);


                    worker_keys = ["5-14 years", "15-34 years", "35-59 years", "Above 60 years"];
                    d3.select('#dataparameters')
                        .selectAll("path")
                        .data(worker_keys)
                        .enter()
                        .append("button")
                        .on("click", parameterClick)
                        .attr("id", d => d)
                        .attr("class", "dataButtons")
                        .html(function(d) {
                            return d;
                        })

                    function parameterClick(datapoint) {
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)
                        if (datapoint == "5-14 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "5-9" || d.Age_Group == "10-14") && d.Rural_or_Urban == "Total")
                            });


                            Calculator(newData);

                        }

                        if (datapoint == "15-34 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "15-19" || d.Age_Group == "20-24" || d.Age_Group == "25-29" || d.Age_Group == "30-34") && d.Rural_or_Urban == "Total")
                            });

                            Calculator(newData);

                        }

                        if (datapoint == "35-59 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "35-39" || d.Age_Group == "40-49" || d.Age_Group == "50-59") && d.Rural_or_Urban == "Total")
                            });

                            Calculator(newData);

                        }

                        if (datapoint == "Above 60 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "60-69" || d.Age_Group == "70-79" || d.Age_Group == "80+") && d.Rural_or_Urban == "Total")
                            });



                            Calculator(newData);

                        }
                    }

                }

                if (datapoint == "Changes since 2001") {

                    d3.select("#notes").text("For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")

                    d3.csv("B4_complete_aggregate.csv", function(error, Data) {


                        worker_keys = ["Percentage Points change in Proportion of Main Workers", "Percentage Points change in Proportion of Main Male Workers", "Percentage Points change in Proportion of Main Female Workers",
                            "Percentage Points change in Agriculture",
                            "Percentage Points change in Manufacturing",
                            "Percentage Points change in Construction",
                            "Percentage Points change in Wholesale",
                            "Percentage Points change in Services"
                        ];
                        d3.select('#dataparameters')
                            .selectAll("path")
                            .data(worker_keys)
                            .enter()
                            .append("button")
                            .on("click", parameterClick)
                            .attr("id", d => d)
                            .attr("class", "dataButtons")
                            .html(function(d) {
                                return d;
                            })


                        function parameterClick(datapoint) {
                            d3.selectAll(".dataButtons").style("background", "transparent")
                            d3.select(this).style("background", backgroundColour)
                            if (datapoint == "Percentage Points change in Proportion of Main Workers") {

                                Calculator5(Data, "PPChangeinMain");

                            }

                            if (datapoint == "Percentage Points change in Proportion of Main Male Workers") {

                                Calculator5(Data, "PPChangeinMainMale");

                            }
                            if (datapoint == "Percentage Points change in Proportion of Main Female Workers") {

                                Calculator5(Data, "PPChangeinMainFemale");

                            }
                            if (datapoint == "Percentage change in Female participation") {

                                Calculator5(Data, "PPChangeinFemaleParticipation");

                            }
                            if (datapoint == "Percentage Points change in Agriculture") {

                                Calculator5(Data, "PPChangeAgriculture");

                            }
                            if (datapoint == "Percentage Points change in Manufacturing") {

                                Calculator5(Data, "PPChangeinManufacturing");

                            }
                            if (datapoint == "Percentage Points change in Wholesale") {

                                Calculator5(Data, "PPChangeinWholesale");

                            }
                            if (datapoint == "Percentage Points change in Services") {

                                Calculator5(Data, "PPChangeinServices");

                            }
                            if (datapoint == "Percentage Points change in Construction") {

                                Calculator5(Data, "PPChangeinConstruction");

                            }

                            if (datapoint == "Percentage Point Change in Non Agricultural Work") {

                                Calculator5(Data, "PPChangeinNonAgriculturalWork");

                            }



                        }


                    })

                }

                if (datapoint == "Main Workers by Industry") {
                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.csv("B4_complete_aggregate.csv", function(error, Data) {

                        category_keys = ["Agriculture",
                            "Manufacturing",
                            "Wholesale and Retail Trade",
                            "Construction",
                            "Services", "Non-Agricultural Industries", "Detailed Breakdown (Industry wise)"
                        ];

                        d3.select('#categoryparameters')
                            .selectAll("path")
                            .data(category_keys)
                            .enter()
                            .append("button")
                            .on("click", categoryClick)
                            .attr("id", d => d)
                            .attr("class", "categoryButtons")
                            .html(function(d) {
                                return d;
                            })

                        function categoryClick(datapoint) {
                            d3.selectAll(".categoryButtons").style("background", "transparent")
                            d3.select(this).style("background", backgroundColour)

                            if (datapoint == "Agriculture") {
                                Calculator3(Data, "Agriculture2011");

                            }
                            if (datapoint == "Manufacturing") {
                                Calculator3(Data, "Manufacturing2011");

                            }
                            if (datapoint == "Wholesale and Retail Trade") {
                                Calculator3(Data, "WholesaleRetail2011");

                            }
                            if (datapoint == "Construction") {
                                Calculator3(Data, "Construction2011");

                            }
                            if (datapoint == "Services") {
                                Calculator3(Data, "Services2011");

                            }

                            if (datapoint == "Non-Agricultural Industries") {
                                Calculator3(Data, "NonAgriculture2011");

                            }

                            if (datapoint == "Detailed Breakdown (Industry wise)") {

                                d3.selectAll(".dataButtons").remove()
                                d3.selectAll(".annotation-group").remove();


                                industry_keys = ["Workers by Industry at a District Level", "Workers by Industry at a Total Level"];


                                d3.select('#industryparameters')
                                    .selectAll("path")
                                    .data(industry_keys)
                                    .enter()
                                    .append("button")
                                    .on("click", industryClick)
                                    .attr("id", d => d)
                                    .attr("class", "industryButtons")
                                    .html(function(d) {
                                        return d;
                                    })

                                function industryClick(functiondatapoint) {
                                    d3.selectAll(".industryButtons").style("background", "transparent")
                                    d3.select(this).style("background", backgroundColour)

                                    d3.selectAll(".dataButtons").remove()
                                    d3.selectAll(".annotation-group").remove();


                                    d3.csv("mergedTotal_B4.csv", function(error, Data) {

                                        worker_keys = ["Select an Industry", "Cultivators",
                                            "Agricultural Labourers",
                                            "Plantation, Livestock, Forestry",
                                            "Mining and Quarrying",
                                            "Manufacturing (Household)",
                                            "Manufacturing (Non Household)",
                                            "Electricity and Water Supply",
                                            "Construction",
                                            "Wholesale and Retail Trade (Household)",
                                            "Wholesale and Retail Trade (Non Household)",
                                            "Transportation", "Accomodation and Food Service",
                                            "Information and Communication (Household)",
                                            "Information and Communication (Non Household)",
                                            "Financial and Insurance Activities, Real Estate, Professional Scientific Activities",
                                            "Administrative and Support Services, Public Administration and Defense",
                                            "Education, Human Health and Social Service Activities",
                                            "Arts, Entertainment, Other Service Activities (Household)",
                                            "Arts, Entertainment, Other Service Activities (Non Household)"
                                        ];

                                        var select = d3.select('#dataparameters')
                                            .append('select')
                                            .attr('class', 'dataButtons')
                                            .on('change', parameterClick)

                                        var options = select
                                            .selectAll('option')
                                            .data(worker_keys).enter()
                                            .append('option')
                                            .text(function(d) {
                                                return d;
                                            });

                                        function parameterClick() {

                                            datapoint = d3.select(this).property('value');

                                            if (datapoint == "Cultivators") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_Cultivators"
                                                total = Data[26880][variable]



                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }


                                            }

                                            if (datapoint == "Agricultural Labourers") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });




                                                variable = "Total_Labourers"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }


                                            }

                                            if (datapoint == "Plantation, Livestock, Forestry") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_Forestry"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Mining and Quarrying") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_B"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Manufacturing (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_C_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Manufacturing (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_C_NonHHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Electricity and Water Supply") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_DE"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Construction") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_F"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Wholesale and Retail Trade (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_G_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Wholesale and Retail Trade (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_G_NonHHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Transportation") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_H"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Accomodation and Food Service") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_I"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Information and Communication (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_J_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Information and Communication (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_J_NonHHI"
                                                total = Data[26880][variable]

                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Financial and Insurance Activities, Real Estate, Professional Scientific Activities") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_KM"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Administrative and Support Services, Public Administration and Defense") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_NO"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Education, Human Health and Social Service Activities") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_PQ"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Arts, Entertainment, Other Service Activities (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_RU_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Arts, Entertainment, Other Service Activities (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_RU_NonHHI"
                                                total = Data[26880][variable]

                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                        }

                                    })


                                }

                            }

                        }

                    })

                }

            }

        }

        function Marginal_Workers() {
            worker_keys = ["Percentage of Total Workforce", "Marginal Workers by Industry", "Changes since 2001"];
            d3.select('#workerkeys')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {

                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons").style("background", "transparent")
                d3.select(this).style("background", backgroundColour)
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".annotation-group").remove();



                if (datapoint == "Percentage of Total Workforce") {


                    newData = Data.filter(function(d) {
                        return (d.Age_Group == "Total" && d.Rural_or_Urban == "Total")
                    });

                    Calculator7(newData);


                    worker_keys = ["5-14 years", "15-34 years", "35-59 years", "Above 60 years"];
                    d3.select('#dataparameters')
                        .selectAll("path")
                        .data(worker_keys)
                        .enter()
                        .append("button")
                        .on("click", parameterClick)
                        .attr("id", d => d)
                        .attr("class", "dataButtons")
                        .html(function(d) {
                            return d;
                        })

                    function parameterClick(datapoint) {
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)
                        if (datapoint == "5-14 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "5-9" || d.Age_Group == "10-14") && d.Rural_or_Urban == "Total")
                            });


                            Calculator7(newData);

                        }

                        if (datapoint == "15-34 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "15-19" || d.Age_Group == "20-24" || d.Age_Group == "25-29" || d.Age_Group == "30-34") && d.Rural_or_Urban == "Total")
                            });

                            Calculator7(newData);

                        }

                        if (datapoint == "35-59 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "35-39" || d.Age_Group == "40-49" || d.Age_Group == "50-59") && d.Rural_or_Urban == "Total")
                            });

                            Calculator7(newData);

                        }

                        if (datapoint == "Above 60 years") {
                            newData = Data.filter(function(d) {
                                return ((d.Age_Group == "60-69" || d.Age_Group == "70-79" || d.Age_Group == "80+") && d.Rural_or_Urban == "Total")
                            });



                            Calculator7(newData);

                        }
                    }

                }

                if (datapoint == "Changes since 2001") {

                    d3.select("#notes").text("For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")

                    d3.csv("B6_complete_aggregate.csv", function(error, Data) {


                        worker_keys = ["Percentage Points change in Proportion of Marginal Workers", "Percentage Points change in Proportion of Marginal Male Workers", "Percentage Points change in Proportion of Marginal Female Workers",
                            "Percentage Points change in Agriculture",
                            "Percentage Points change in Manufacturing",
                            "Percentage Points change in Construction",
                            "Percentage Points change in Wholesale",
                            "Percentage Points change in Services"
                        ];
                        d3.select('#dataparameters')
                            .selectAll("path")
                            .data(worker_keys)
                            .enter()
                            .append("button")
                            .on("click", parameterClick)
                            .attr("id", d => d)
                            .attr("class", "dataButtons")
                            .html(function(d) {
                                return d;
                            })


                        function parameterClick(datapoint) {
                            d3.selectAll(".dataButtons").style("background", "transparent")
                            d3.select(this).style("background", backgroundColour)
                            if (datapoint == "Percentage Points change in Proportion of Marginal Workers") {

                                Calculator9(Data, "PPChangeinMarginal");

                            }

                            if (datapoint == "Percentage Points change in Proportion of Marginal Male Workers") {

                                Calculator9(Data, "PPChangeinMarginalMale");

                            }
                            if (datapoint == "Percentage Points change in Proportion of Marginal Female Workers") {

                                Calculator9(Data, "PPChangeinMarginalFemale");

                            }
                            if (datapoint == "Percentage change in Female participation") {

                                Calculator9(Data, "PPChangeinFemaleParticipation");

                            }
                            if (datapoint == "Percentage Points change in Agriculture") {

                                Calculator9(Data, "PPChangeAgriculture");

                            }
                            if (datapoint == "Percentage Points change in Manufacturing") {

                                Calculator9(Data, "PPChangeinManufacturing");

                            }
                            if (datapoint == "Percentage Points change in Wholesale") {

                                Calculator9(Data, "PPChangeinWholesale");

                            }
                            if (datapoint == "Percentage Points change in Services") {

                                Calculator9(Data, "PPChangeinServices");

                            }
                            if (datapoint == "Percentage Points change in Construction") {

                                Calculator9(Data, "PPChangeinConstruction");

                            }

                            if (datapoint == "Percentage Point Change in Non Agricultural Work") {

                                Calculator9(Data, "PPChangeinNonAgriculturalWork");

                            }



                        }


                    })

                }

                if (datapoint == "Marginal Workers by Industry") {
                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.csv("B6_complete_aggregate.csv", function(error, Data) {

                        category_keys = ["Agriculture",
                            "Manufacturing",
                            "Wholesale and Retail Trade",
                            "Construction",
                            "Services", "Non-Agricultural Industries", "Detailed Breakdown (Industry wise)"
                        ];

                        d3.select('#categoryparameters')
                            .selectAll("path")
                            .data(category_keys)
                            .enter()
                            .append("button")
                            .on("click", categoryClick)
                            .attr("id", d => d)
                            .attr("class", "categoryButtons")
                            .html(function(d) {
                                return d;
                            })

                        function categoryClick(datapoint) {
                            d3.selectAll(".categoryButtons").style("background", "transparent")
                            d3.select(this).style("background", backgroundColour)

                            if (datapoint == "Agriculture") {
                                Calculator8(Data, "Agriculture2011");

                            }
                            if (datapoint == "Manufacturing") {
                                Calculator8(Data, "Manufacturing2011");

                            }
                            if (datapoint == "Wholesale and Retail Trade") {
                                Calculator8(Data, "WholesaleRetail2011");

                            }
                            if (datapoint == "Construction") {
                                Calculator8(Data, "Construction2011");

                            }
                            if (datapoint == "Services") {
                                Calculator8(Data, "Services2011");

                            }

                            if (datapoint == "Non-Agricultural Industries") {
                                Calculator8(Data, "NonAgriculture2011");

                            }

                            if (datapoint == "Detailed Breakdown (Industry wise)") {

                                d3.selectAll(".dataButtons").remove()
                                d3.selectAll(".annotation-group").remove();


                                industry_keys = ["Workers by Industry at a District Level", "Workers by Industry at a Total Level"];


                                d3.select('#industryparameters')
                                    .selectAll("path")
                                    .data(industry_keys)
                                    .enter()
                                    .append("button")
                                    .on("click", industryClick)
                                    .attr("id", d => d)
                                    .attr("class", "industryButtons")
                                    .html(function(d) {
                                        return d;
                                    })

                                function industryClick(functiondatapoint) {
                                    d3.selectAll(".industryButtons").style("background", "transparent")
                                    d3.select(this).style("background", backgroundColour)

                                    d3.selectAll(".dataButtons").remove()
                                    d3.selectAll(".annotation-group").remove();


                                    d3.csv("mergedTotal_B6.csv", function(error, Data) {

                                        worker_keys = ["Select an Industry", "Cultivators",
                                            "Agricultural Labourers",
                                            "Plantation, Livestock, Forestry",
                                            "Mining and Quarrying",
                                            "Manufacturing (Household)",
                                            "Manufacturing (Non Household)",
                                            "Electricity and Water Supply",
                                            "Construction",
                                            "Wholesale and Retail Trade (Household)",
                                            "Wholesale and Retail Trade (Non Household)",
                                            "Transportation", "Accomodation and Food Service",
                                            "Information and Communication (Household)",
                                            "Information and Communication (Non Household)",
                                            "Financial and Insurance Activities, Real Estate, Professional Scientific Activities",
                                            "Administrative and Support Services, Public Administration and Defense",
                                            "Education, Human Health and Social Service Activities",
                                            "Arts, Entertainment, Other Service Activities (Household)",
                                            "Arts, Entertainment, Other Service Activities (Non Household)"
                                        ];

                                        var select = d3.select('#dataparameters')
                                            .append('select')
                                            .attr('class', 'dataButtons')
                                            .on('change', parameterClick)

                                        var options = select
                                            .selectAll('option')
                                            .data(worker_keys).enter()
                                            .append('option')
                                            .text(function(d) {
                                                return d;
                                            });

                                        function parameterClick() {

                                            datapoint = d3.select(this).property('value');

                                            if (datapoint == "Cultivators") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_Cultivators"
                                                total = Data[26880][variable]



                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }


                                            }

                                            if (datapoint == "Agricultural Labourers") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });




                                                variable = "Total_Labourers"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }


                                            }

                                            if (datapoint == "Plantation, Livestock, Forestry") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_Forestry"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Mining and Quarrying") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_B"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Manufacturing (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_C_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Manufacturing (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_C_NonHHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Electricity and Water Supply") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_DE"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Construction") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_F"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Wholesale and Retail Trade (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_G_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Wholesale and Retail Trade (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_G_NonHHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Transportation") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_H"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Accomodation and Food Service") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_I"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Information and Communication (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_J_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Information and Communication (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_J_NonHHI"
                                                total = Data[26880][variable]

                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }
                                            }

                                            if (datapoint == "Financial and Insurance Activities, Real Estate, Professional Scientific Activities") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_KM"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Administrative and Support Services, Public Administration and Defense") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_NO"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Education, Human Health and Social Service Activities") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_PQ"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Arts, Entertainment, Other Service Activities (Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_RU_HHI"
                                                total = Data[26880][variable]


                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                            if (datapoint == "Arts, Entertainment, Other Service Activities (Non Household)") {
                                                newData = Data.filter(function(d) {
                                                    return ((d.Age == "Total" && d.Rural_or_Urban == "Total"));
                                                });

                                                variable = "Total_RU_NonHHI"
                                                total = Data[26880][variable]

                                                if (functiondatapoint == "Workers by Industry at a Total Level") {
                                                    Calculator4(newData, variable, total);
                                                }

                                                if (functiondatapoint == "Workers by Industry at a District Level") {
                                                    Calculator6(newData, variable);
                                                }

                                            }

                                        }

                                    })


                                }

                            }

                        }

                    })

                }

            }

        }

    }
    </script>
</body>

</html>