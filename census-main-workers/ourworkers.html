<!DOCTYPE html>
<html lang="en">

<head>
    <title>How India Works</title>
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans+Extra+Condensed:300,400,600,900" rel="stylesheet">
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-queue.v2.min.js"></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <style>
    body {
        font-family: "Fira Sans Extra Condensed", sans-serif;
    }

    h1,
    h2,
    h6 {

        text-align: center;
    }

    h1 {
        font-size: 2em;
        font-weight: 900;
    }

    p,
    ul {
        font-weight: 600;
        font-size: 1.25em;
    }

    h3 {
        font-size: 1em;
        font-weight: 600;
    }

    h4,
    h5,
    .label {
        font-size: 0.8em;
        font-weight: 400;
        text-align: left;
    }

    .stateLabel {
        font-size: 0.7em;
        font-weight: 400;

    }


    h6 {
        color: #f49416;
        font-size: 0.8em;
        font-weight: 300;
    }

    path.hover {
        stroke-width: 1.25px;
        opacity: 1;
    }

    path {
        stroke-width: 0.75px;
        opacity: 0.9;
    }

    button {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
    }

    select {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
    }

    #centered {
        width: 500px;
        text-align: left;
        margin: 0 auto;
    }

    .dataButtons {
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 1em;
        border: 0px;
        background: transparent;
        text-decoration: underline;
    }

    .toolTip {
        position: absolute;
        display: none;
        min-width: 60px;
        height: auto;
        background: none repeat scroll 0 0 #ffffff;
        border: 1.5px solid #000000;
        padding: 10px;
        text-align: center;
        font-family: "Fira Sans Extra Condensed", sans-serif;
        font-weight: 600;
        font-size: 0.8em;
    }

    .annotation-group {
        pointer-events: none
    }

    .typesofworkers {
        margin-top: 25px;
    }

    div {
        margin: 15px;
    }

    /* Style the tab */
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #EEE5DD;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab button:hover {
        background-color: #ddd;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #ccc;
    }

    .dashboard-main {
        -webkit-column-count: 2;
        /* Chrome, Safari, Opera */
        -moz-column-count: 2;
        /* Firefox */
        column-count: 2;
        height: 100%;
    }

    .left-panel {
        float: left;
        width: 20%;
    }

    .canvas {
        float: right;
        width: 80%;
    }
    </style>
</head>

<body>
    <div id="w3-container">
        <div id="typesofworkers" class="tab" title="As defined in the Census" align="center" style="font-size : 1.5em"></div>
        <div id="datagroups" class="tab" align="center" style="font-size : 1.2em"></div>
        <div id="industryviews" class="tab" align="center"></div>
        <div class="left-panel">
            <div id="agefilterheader" align="left">
                <p id="ageheader"></p>
            </div>
            <div id="ageviews" align="left"></div>
            <div id="sexfilterheader" align="left">
                <p id="sexheader"></p>
            </div>
            <div id="sexviews" align="left"></div>
            <div id="scaleparameters" align="center"></div>
            <div id="dataparameters" align="center"></div>
            <div id="industryfilterheader" align="left">
                <p id="industryheader"></p>
            </div>
            <div id="detailedindustries" align=left></div>
            <div>
                <p id="top10listheader">
                    <p>
            </div>
            <div id="top10list"></div>
            <h3 id="instruction"></h3>
        </div>
        <div id="canvas" align="center"></div>
    </div>
    <div><h3> Source : Census 2001, Census 2011 </h3>
        <h3> Notes </h3>
        <div id="notes" align="left"></div>
    </div>
    <script>
    var width = 800;
    var height = 800;

    var aspect = width / height,
        chart = d3.select('#chart');


    var zoom = d3.zoom()
        .on("zoom", zoomed);

    // Create SVG
    var svg = d3.select("#canvas")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .attr("align", "center");

    function zoomed() {
        var transform = d3.event.transform;

        svg.style("stroke-width", 1.5 / transform.k + "px");
        svg.attr("transform", transform);
    }

    var geoProjection = d3.geoMercator()
        .scale(1200)
        .center([83, 23])
        .translate([width / 2, height / 2]);

    var geoPath = d3.geoPath()
        .projection(geoProjection);

    var tooltip = d3.select("body").append("div").attr("class", "toolTip");

    var Hyderabad = [536, 537]
    var Bangalore = [572, 583]
    var Chennai = [602, 603, 604]
    var Kolkata = [336, 337, 338, 341, 342, 343]
    var Mumbai = [517, 518, 519, 520, 521]
    var Delhi = [74, 75, 77, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 104, 105, 133, 138, 139, 140, 141, 142]


    d3.queue()
        .defer(d3.json, "india_districts.json")
        .defer(d3.csv, "Final2011.csv")
        .defer(d3.json, "india.json")
        .defer(d3.csv, "B4_complete_aggregate_15.csv")
        .defer(d3.csv, "B4_complete_aggregate_25.csv")
        .defer(d3.csv, "B6_complete_aggregate_15.csv")
        .defer(d3.csv, "B6_complete_aggregate_25.csv")
        .defer(d3.csv, "B4B62011_15.csv")
        .defer(d3.csv, "B4B62011_25.csv")
        .await(ready);


    function ready(error, india, FinalData, indiaState, B415, B425, B615, B625, B4B615, B4B625) {

        if (error) throw error;

        var allStates = svg.append("g")
            .selectAll("path")
            .data(topojson.feature(indiaState, indiaState.objects.india).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .style("stroke", "#000000")
            .style("fill", "transparent")
            .style("stroke-width", "1.5px")

        var allDistricts = svg.append("g")
            .attr("id", "allDistricts")
            .selectAll("path")
            .data(topojson.feature(india, india.objects.india_district).features)
            .enter()
            .append("path")
            .attr("d", geoPath)
            .attr("class", "district")
            .attr("id", function(d) {
                return ("b" + d.properties.censuscode)
            })
            .style("fill", "#f0f0f0")
            .style("stroke", "transparent")
            .style("stroke-width", '2px')
            .style("opacity", 0.85)

        const filterKeys = ["ALL WORKERS", "REGULAR WORKERS", "SEASONAL WORKERS"]

        backgroundColour = "#F7941D"


        d3.select('#typesofworkers')
            .selectAll("path")
            .data(filterKeys)
            .enter()
            .append("button")
            .on("click", buttonClick)
            .attr("id", d => d)
            .attr("class", "workerButtons")
            .style("background", (d, i) => i === 0 ? backgroundColour : "transparent")
            .html(function(d) {
                return d;
            })


        function buttonClick(datapoint) {
            d3.selectAll(".workerButtons").style("background", "transparent")
            d3.select(this).style("background", backgroundColour)
            d3.selectAll(".dataButtons").remove()
            d3.selectAll(".parameterButtons").remove()
            d3.selectAll(".categoryButtons").remove()
            d3.selectAll(".industryButtons").remove()
            d3.selectAll(".annotation-group").remove();
            d3.selectAll(".sexButtons").remove()



            if (datapoint == "REGULAR WORKERS") {
                Main_Workers()
            }

            if (datapoint == "SEASONAL WORKERS") {
                Marginal_Workers()
            }

            if (datapoint == "ALL WORKERS") {
                Total_Workers()
            }

        }

        function drawLegendandTooltip(colourScale, districtData, token, title) {

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,50)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title(title)
                .scale(colourScale)
                .orient("horizontal")
                .labelWrap(25)
                .shapeWidth(30)

            svg.select(".legendQuant")
                .call(legend);

            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                if (d.properties.DISTRICT != "Data Not Available") {
                    tooltip
                        .style("left", d3.event.pageX - 50 + "px")
                        .style("top", d3.event.pageY - 70 + "px")
                        .style("display", "inline-block")
                        .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode].toFixed(2));

                }

            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })

            if (token == "yes") {
                var newLabel = d3.selectAll(".legendCells").append("g").attr("class", "cell").attr("transform", "translate(128,0)")
                newLabel.append("rect").attr("class", "swatch").attr("height", "15").attr("width", "30").style("fill", "rgb(189,56,132)")
                newLabel.append("text").attr("class", "label").attr("transform", "translate(0,33)").style("text-anchor", "left").append("tspan").text("Top 10 districts")
            }

        }

        function Annotate(numbers) {
            d3.selectAll(".annotation-group").remove();

            const annotations = [{
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[5].toFixed(2) + " percent",
                        title: "Delhi NCR",
                        wrap: 300
                    },
                    subject: {
                        radius: 25

                    },
                    x: 275,
                    y: 270,
                    dy: -75,
                    dx: -75
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[4].toFixed(2) + " percent",
                        title: "Mumbai-Pune region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 195,
                    y: 490,
                    dy: 75,
                    dx: -75
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[0].toFixed(2) + " percent",
                        title: "Hyderabad region",
                        wrap: 100
                    },

                    subject: {
                        radius: 12

                    },
                    x: 300,
                    y: 527,
                    dy: 0,
                    dx: 100
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[3].toFixed(2) + " percent",
                        title: "Kolkata region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 515,
                    y: 410,
                    dy: 70,
                    dx: 70
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[2].toFixed(2) + " percent",
                        title: "Chennai region",
                        wrap: 100
                    },

                    subject: {
                        radius: 15

                    },
                    x: 335,
                    y: 625,
                    dy: 50,
                    dx: 50
                },
                {
                    type: d3.annotationCalloutCircle,
                    note: {
                        label: numbers[1].toFixed(2) + " percent",
                        title: "Bangalore region",
                        wrap: 100
                    },

                    subject: {
                        radius: 12

                    },
                    x: 285,
                    y: 620,
                    dy: 100,
                    dx: -100
                }
            ].map(function(d) {
                d.color = "#000000";
                return d
            })

            const makeAnnotations = d3.annotation()
                .type(d3.annotationLabel)
                .annotations(annotations)

            d3.select("svg")
                .append("g")
                .attr("class", "annotation-group")
                .call(makeAnnotations)
        }


        function PercentofTotalWorkers(Data, kindofworker) {

            d3.select("#notes").text("Total Workforce is defined as the sum of all Regular and Seasonal workers.")
            d3.selectAll(".item").remove()

            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        }),
                        variable3: d3.sum(d, function(e) {
                            return e[variable3];
                        }),
                    }
                })
                .entries(Data);

            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])
                if (kindofworker == "Regular") {
                    d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['total_workforce'])
                }
                if (kindofworker == "Seasonal") {
                    d.value['percentage'] = ((((d.value['variable2'] + (d.value['variable3'])) * 100) / d.value['total_workforce']))
                }
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#B2C483", "#81A53E"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []


            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }


            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })

            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                }

                if (kindofworker == "Regular") {
                    percentage_n = (variablen1 * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                }

                if (kindofworker == "Seasonal") {
                    percentage_n = ((variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3).toFixed(2);
                }

                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = kindofworker + " workers as % of Total workers"

            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);

        }


        function Calculator3(Data, variable, kindofworker) {


            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = parseInt(d['DistrictCode'])
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })


            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0
                var total_population = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    percentage = +Data[id_no - 1][variable]

                    if (kindofworker == "Regular") {
                        population = +Data[id_no - 1]['MainWorkers2011']

                        variablevalue = variablevalue + ((percentage) * population)
                        total_population = total_population + (+Data[id_no - 1]['MainWorkers2011'])

                    } else if (kindofworker = "Seasonal") {
                        population = +Data[id_no - 1]['MarginalWorkers2011']
                        variablevalue = variablevalue + ((percentage) * population)
                        total_population = total_population + (+Data[id_no - 1]['MarginalWorkers2011'])
                    }

                }
                percentage_n = variablevalue / total_population

                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);


        }


        function Calculator4(Data, variable, total) {

            variable1 = variable
            variable2 = total;

            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        total: +total
                    };
                })
                .entries(newData);

            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / variable2)
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#ffffcc", "#a1dab4", "#41b6c4", "#225ea8"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var count = 0
            while (count < 10) {
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablevalue = 0

                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablevalue = variablevalue + districtDatabyDistrict[id_no - 1].value['variable1']
                }
                percentage_n = (variablevalue * 100) / total
                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            drawLegendandTooltip(colourScale, districtData, "yes");
            Annotate(city_array);


        }

        function ChangeSince2001(Data, variable, kindofworker) {

            d3.selectAll(".item").remove()

            var items = Data.map(post => +post[variable]);

            var colourScale = d3.scaleQuantile().domain(items).range(["#D71920", "#E2694D", "#A2B86F", "#81A53E"]);

            var districtData = {}
            Data.forEach(function(d) {
                district_variable_count = d.DistrictCode
                districtData[district_variable_count] = +d[variable];
                var colourState = colourScale(+d[variable]);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })
            var districtName = {}
            Data.forEach(function(d) {
                district_variable_count = d.DistrictCode
                districtName[district_variable_count] = d.Area
            })


            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []



            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtName[id].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            var var2011;
            var var2001;
            if (variable == "PPChangeAgriculture") {
                var2001 = 'Agriculture2001'
                var2011 = 'Agriculture2011'
            }

            if (variable == "PPChangeinManufacturing") {
                var2001 = 'Manufacturing2001'
                var2011 = 'Manufacturing2011'
            }

            if (variable == "PPChangeinConstruction") {
                var2001 = 'Construction2001'
                var2011 = 'Construction2011'
            }

            if (variable == "PPChangeinWholesale") {
                var2001 = 'WholesaleRetail2001'
                var2011 = 'WholesaleRetail2011'
            }

            if (variable == "PPChangeinServices") {
                var2001 = 'Services2001'
                var2011 = 'Services2011'
            }

            if (variable == "PPChangeinMain") {
                var2001 = 'PerMainWorkers2001'
                var2011 = 'PerMainWorkers2011'
            }
            if (variable == "PPChangeinMainMale") {
                var2001 = 'PerMainMale2001'
                var2011 = 'PerMainMale2011'
            }
            if (variable == "PPChangeinMainFemale") {
                var2001 = 'PerMainFemale2001'
                var2011 = 'PerMainFemale2011'
            }

            if (variable == "PPChangeinMarginal") {
                var2001 = 'PerMarginalWorkers2001'
                var2011 = 'PerMarginalWorkers2011'
            }
            if (variable == "PPChangeinMarginalMale") {
                var2001 = 'PerMarginalMale2001'
                var2011 = 'PerMarginalMale2011'
            }
            if (variable == "PPChangeinMarginalFemale") {
                var2001 = 'PerMarginalFemale2001'
                var2011 = 'PerMarginalFemale2011'
            }


            function UrbanAggCalculator(city) {

                lengthofids = city.length
                var variable2011 = 0
                var variable2001 = 0
                var total2001 = 0
                var total2011 = 0
                var variable1 = 0
                var variable2 = 0
                for (item = 0; item < (lengthofids); item++) {

                    id_no = city[item]

                    if (kindofworker == "Regular") {

                        variable2011 = +(Data[id_no - 1]['MainWorkers2011'] * Data[id_no - 1][var2011])
                        total2011 = total2011 + (+Data[id_no - 1]['MainWorkers2011'])
                        variable1 = variable1 + variable2011
                        if (id_no == 87 || id_no == 89) {
                            variable2001 = 0
                            variable2 = variable2 + variable2001
                            total2001 = total2001
                        } else {
                            variable2001 = (Data[id_no - 1]['MainWorkersTotal2001'] * Data[id_no - 1][var2001])
                            variable2 = variable2 + variable2001
                            total2001 = total2001 + (+Data[id_no - 1]['MainWorkersTotal2001'])
                        }


                    }

                    if (kindofworker == "Seasonal") {

                        variable2011 = +(Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2011])

                        total2011 = total2011 + (+Data[id_no - 1]['MarginalWorkers2011'])
                        variable1 = variable1 + variable2011
                        if (id_no == 87 || id_no == 89) {
                            variable2001 = 0
                            variable2 = variable2 + variable2001
                            total2001 = total2001
                        } else {
                            variable2001 = (Data[id_no - 1]['MarginalWorkers2011'] * Data[id_no - 1][var2001])
                            variable2 = variable2 + variable2001
                            total2001 = total2001 + (+Data[id_no - 1]['MarginalWorkers2011'])
                        }

                    }

                    if (kindofworker == "All") {

                        variable2011 = +(Data[id_no - 1]['TotalWorkers2011'] * Data[id_no - 1][var2011])

                        total2011 = total2011 + (+Data[id_no - 1]['TotalWorkers2011'])
                        variable1 = variable1 + variable2011
                        if (id_no == 87 || id_no == 89) {
                            variable2001 = 0
                            variable2 = variable2 + variable2001
                            total2001 = total2001
                        } else {
                            variable2001 = (Data[id_no - 1]['TotalWorkers2011'] * Data[id_no - 1][var2001])
                            variable2 = variable2 + variable2001
                            total2001 = total2001 + (+Data[id_no - 1]['TotalWorkers2011'])
                        }

                    }

                }

                percentage1 = (variable1 / total2011)
                percentage2 = (variable2 / total2001)


                percentage_n = percentage1 - percentage2
                return percentage_n;

            }

            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]


            title="% pts change"

            drawLegendandTooltip(colourScale, districtData, "yes",title);
            Annotate(city_array);


        }

        function MainWorkersByIndustry(Data, variable, domain) {

            d3.selectAll(".item").remove()
            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")

            d3.selectAll
            variable1 = variable
            variable2 = "Total_Workers_Main"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        })
                    };
                })
                .entries(newData);


            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / (d.value['variable2']))
            })


            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                }

                percentage_n = (variablen1 * 100) / (variablen2).toFixed(2);
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]



            title = "% of all Regular workers in " + domain + " industries"
            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);




        }

        function MarginalWorkersByIndustry(Data, variable, domain) {


            d3.selectAll(".item").remove()
            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")

            d3.selectAll
            variable1 = variable
            variable2 = "Total_Workers_Marginal"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        })
                    };
                })
                .entries(newData);


            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / (d.value['variable2']))
            })


            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                }

                percentage_n = (variablen1 * 100) / (variablen2).toFixed(2);
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]



            title = "% of all Seasonal workers in " + domain + " industries"
            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);




        }

        function TotalWorkersByIndustry(Data, variable, domain) {

            d3.selectAll(".item").remove()
            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")

            d3.selectAll
            variable1 = variable
            variable2 = "Total_Workers_Total"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        })
                    };
                })
                .entries(newData);


            districtDatabyDistrict.forEach(function(d) {
                d.value['percentage'] = ((d.value['variable1']) * 100 / (d.value['variable2']))
            })


            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);

            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage'];
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]
                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                }

                percentage_n = (variablen1 * 100) / (variablen2).toFixed(2);
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]



            title = "% of all Regular workers in " + domain + " industries"
            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);




        }


        function MainLargestEmployer(Data, sex) {

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")


            if (sex == "All") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Total_Cultivators_Main: d3.sum(d, function(e) {
                                return e['Total_Cultivators_Main'];
                            }),
                            Total_Labourers_Main: d3.sum(d, function(e) {
                                return e['Total_Labourers_Main'];
                            }),
                            Total_Forestry_Main: d3.sum(d, function(e) {
                                return e['Total_Forestry_Main'];
                            }),
                            Total_B_Main: d3.sum(d, function(e) {
                                return e['Total_B_Main'];
                            }),
                            Total_C_HHI_Main: d3.sum(d, function(e) {
                                return e['Total_C_HHI_Main'];
                            }),
                            Total_C_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Total_C_NonHHI_Main'];
                            }),
                            Total_DE_Main: d3.sum(d, function(e) {
                                return e['Total_DE_Main'];
                            }),
                            Total_F_Main: d3.sum(d, function(e) {
                                return e['Total_F_Main'];
                            }),
                            Total_G_HHI_Main: d3.sum(d, function(e) {
                                return e['Total_G_HHI_Main'];
                            }),
                            Total_G_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Total_G_NonHHI_Main'];
                            }),
                            Total_H_Main: d3.sum(d, function(e) {
                                return e['Total_H_Main'];
                            }),
                            Total_I_Main: d3.sum(d, function(e) {
                                return e['Total_I_Main'];
                            }),
                            Total_J_HHI_Main: d3.sum(d, function(e) {
                                return e['Total_J_HHI_Main'];
                            }),
                            Total_J_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Total_J_NonHHI_Main'];
                            }),
                            Total_KM_Main: d3.sum(d, function(e) {
                                return e['Total_KM_Main'];
                            }),
                            Total_NO_Main: d3.sum(d, function(e) {
                                return e['Total_NO_Main'];
                            }),
                            Total_PQ_Main: d3.sum(d, function(e) {
                                return e['Total_PQ_Main'];
                            }),
                            Total_RU_HHI_Main: d3.sum(d, function(e) {
                                return e['Total_RU_HHI_Main'];
                            }),
                            Total_RU_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Total_RU_NonHHI_Main'];
                            }),
                        }
                    })
                    .entries(Data);
            }

            if (sex = "Male") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Male_Cultivators_Main: d3.sum(d, function(e) {
                                return e['Male_Cultivators_Main'];
                            }),
                            Male_Labourers_Main: d3.sum(d, function(e) {
                                return e['Male_Labourers_Main'];
                            }),
                            Male_Forestry_Main: d3.sum(d, function(e) {
                                return e['Male_Forestry_Main'];
                            }),
                            Male_B_Main: d3.sum(d, function(e) {
                                return e['Male_B_Main'];
                            }),
                            Male_C_HHI_Main: d3.sum(d, function(e) {
                                return e['Male_C_HHI_Main'];
                            }),
                            Male_C_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Male_C_NonHHI_Main'];
                            }),
                            Male_DE_Main: d3.sum(d, function(e) {
                                return e['Male_DE_Main'];
                            }),
                            Male_F_Main: d3.sum(d, function(e) {
                                return e['Male_F_Main'];
                            }),
                            Male_G_HHI_Main: d3.sum(d, function(e) {
                                return e['Male_G_HHI_Main'];
                            }),
                            Male_G_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Male_G_NonHHI_Main'];
                            }),
                            Male_H_Main: d3.sum(d, function(e) {
                                return e['Male_H_Main'];
                            }),
                            Male_I_Main: d3.sum(d, function(e) {
                                return e['Male_I_Main'];
                            }),
                            Male_J_HHI_Main: d3.sum(d, function(e) {
                                return e['Male_J_HHI_Main'];
                            }),
                            Male_J_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Male_J_NonHHI_Main'];
                            }),
                            Male_KM_Main: d3.sum(d, function(e) {
                                return e['Male_KM_Main'];
                            }),
                            Male_NO_Main: d3.sum(d, function(e) {
                                return e['Male_NO_Main'];
                            }),
                            Male_PQ_Main: d3.sum(d, function(e) {
                                return e['Male_PQ_Main'];
                            }),
                            Male_RU_HHI_Main: d3.sum(d, function(e) {
                                return e['Male_RU_HHI_Main'];
                            }),
                            Male_RU_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Male_RU_NonHHI_Main'];
                            }),
                        }
                    })
                    .entries(Data);

            }

            if (sex == "Female") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Female_Cultivators_Main: d3.sum(d, function(e) {
                                return e['Female_Cultivators_Main'];
                            }),
                            Female_Labourers_Main: d3.sum(d, function(e) {
                                return e['Female_Labourers_Main'];
                            }),
                            Female_Forestry_Main: d3.sum(d, function(e) {
                                return e['Female_Forestry_Main'];
                            }),
                            Female_B_Main: d3.sum(d, function(e) {
                                return e['Female_B_Main'];
                            }),
                            Female_C_HHI_Main: d3.sum(d, function(e) {
                                return e['Female_C_HHI_Main'];
                            }),
                            Female_C_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Female_C_NonHHI_Main'];
                            }),
                            Female_DE_Main: d3.sum(d, function(e) {
                                return e['Female_DE_Main'];
                            }),
                            Female_F_Main: d3.sum(d, function(e) {
                                return e['Female_F_Main'];
                            }),
                            Female_G_HHI_Main: d3.sum(d, function(e) {
                                return e['Female_G_HHI_Main'];
                            }),
                            Female_G_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Female_G_NonHHI_Main'];
                            }),
                            Female_H_Main: d3.sum(d, function(e) {
                                return e['Female_H_Main'];
                            }),
                            Female_I_Main: d3.sum(d, function(e) {
                                return e['Female_I_Main'];
                            }),
                            Female_J_HHI_Main: d3.sum(d, function(e) {
                                return e['Female_J_HHI_Main'];
                            }),
                            Female_J_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Female_J_NonHHI_Main'];
                            }),
                            Female_KM_Main: d3.sum(d, function(e) {
                                return e['Female_KM_Main'];
                            }),
                            Female_NO_Main: d3.sum(d, function(e) {
                                return e['Female_NO_Main'];
                            }),
                            Female_PQ_Main: d3.sum(d, function(e) {
                                return e['Female_PQ_Main'];
                            }),
                            Female_RU_HHI_Main: d3.sum(d, function(e) {
                                return e['Female_RU_HHI_Main'];
                            }),
                            Female_RU_NonHHI_Main: d3.sum(d, function(e) {
                                return e['Female_RU_NonHHI_Main'];
                            }),
                        }
                    })
                    .entries(Data);
            }


            var colourScale = d3.scaleOrdinal().domain(["Agricultural Labourers",
                "Cultivators",
                "Manufacturing",
                "Construction",
                "Trade",
                "Education and Health",
                "Administration and Defence",
                "Plantation etc",
                "Mining",
                "Other Services",
                "Transportation"
            ]).range(["b29f34",
                "789b3e",
                "637474",
                "33464d",
                "e58a2e",
                "734785",
                "23597c",
                "54603a",
                "161819",
                "bc352a",
                "ffffff"
            ]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                code = d.key
                item = d.value
                max = Object.keys(item).reduce((a, b) => item[a] > item[b] ? a : b);
                if (max == "Total_Cultivators_Main" || max == "Male_Cultivators_Main" || max == "Female_Cultivators_Main") {
                    max = "Cultivators"
                }
                if (max == "Total_Labourers_Main" || max == "Male_Labourers_Main" || max == "Female_Labourers_Main") {
                    max = "Agricultural Labourers"
                }
                if (max == "Total_Forestry_Main" || max == "Male_Forestry_Main" || max == "Female_Forestry_Main") {
                    max = "Plantation, Livestock, Forestry"
                }
                if (max == "Total_B_Main" || max == "Male_B_Main" || max == "Female_B_Main") {
                    max = "Mining"
                }
                if (max == "Total_C_HHI_Main" || max == "Male_C_HHI_Main" || max == "Female_C_HHI_Main") {
                    max = "Manufacturing"
                }
                if (max == "Total_C_NonHHI_Main" || max == "Male_C_NonHHI_Main" || max == "Female_C_NonHHI_Main") {
                    max = "Manufacturing"
                }
                if (max == "Total_F_Main" || max == "Male_F_Main" || max == "Female_F_Main") {
                    max = "Construction"
                }
                if (max == "Total_H_Main" || max == "Male_H_Main" || max == "Female_H_Main") {
                    max = "Transportation"
                }
                if (max == "Total_G_HHI_Main" || max == "Male_G_HHI_Main" || max == "Female_G_HHI_Main") {
                    max = "Trade"
                }
                if (max == "Total_G_NonHHI_Main" || max == "Male_G_NonHHI_Main" || max == "Female_G_NonHHI_Main") {
                    max = "Trade"
                }
                if (max == "Total_NO_Main" || max == "Male_NO_Main" || max == "Female_NO_Main") {
                    max = "Administration and Defence"
                }
                if (max == "Total_PQ_Main" || max == "Male_PQ_Main" || max == "Female_PQ_Main") {
                    max = "Education and Health"
                }
                if (max == "Total_RU_HHI_Main" || max == "Male_RU_HHI_Main" || max == "Female_RU_HHI_Main") {
                    max = "Other Services"
                }
                if (max == "Total_RU_NonHHI_Main" || max == "Male_RU_NonHHI_Main" || max == "Female_RU_NonHHI_Main") {
                    max = "Other Services"
                }
                districtData[code] = max;
                var colourState = colourScale(max);
                d3.select("#b" + code).transition().duration(1000).style("fill", colourState);
            })

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,20)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Industry")
                .scale(colourScale)

            svg.select(".legendQuant")
                .call(legend);


            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode]);
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })


        }

        function MarginalLargestEmployer(Data, sex) {

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")



            if (sex == "All") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Total_Cultivators_Marginal: d3.sum(d, function(e) {
                                return e['Total_Cultivators_Marginal'];
                            }),
                            Total_Labourers_Marginal: d3.sum(d, function(e) {
                                return e['Total_Labourers_Marginal'];
                            }),
                            Total_Forestry_Marginal: d3.sum(d, function(e) {
                                return e['Total_Forestry_Marginal'];
                            }),
                            Total_B_Marginal: d3.sum(d, function(e) {
                                return e['Total_B_Marginal'];
                            }),
                            Total_C_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_C_HHI_Marginal'];
                            }),
                            Total_C_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_C_NonHHI_Marginal'];
                            }),
                            Total_DE_Marginal: d3.sum(d, function(e) {
                                return e['Total_DE_Marginal'];
                            }),
                            Total_F_Marginal: d3.sum(d, function(e) {
                                return e['Total_F_Marginal'];
                            }),
                            Total_G_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_G_HHI_Marginal'];
                            }),
                            Total_G_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_G_NonHHI_Marginal'];
                            }),
                            Total_H_Marginal: d3.sum(d, function(e) {
                                return e['Total_H_Marginal'];
                            }),
                            Total_I_Marginal: d3.sum(d, function(e) {
                                return e['Total_I_Marginal'];
                            }),
                            Total_J_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_J_HHI_Marginal'];
                            }),
                            Total_J_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_J_NonHHI_Marginal'];
                            }),
                            Total_KM_Marginal: d3.sum(d, function(e) {
                                return e['Total_KM_Marginal'];
                            }),
                            Total_NO_Marginal: d3.sum(d, function(e) {
                                return e['Total_NO_Marginal'];
                            }),
                            Total_PQ_Marginal: d3.sum(d, function(e) {
                                return e['Total_PQ_Marginal'];
                            }),
                            Total_RU_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_RU_HHI_Marginal'];
                            }),
                            Total_RU_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Total_RU_NonHHI_Marginal'];
                            }),
                        }
                    })
                    .entries(Data);
            }

            if (sex = "Male") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Male_Cultivators_Marginal: d3.sum(d, function(e) {
                                return e['Male_Cultivators_Marginal'];
                            }),
                            Male_Labourers_Marginal: d3.sum(d, function(e) {
                                return e['Male_Labourers_Marginal'];
                            }),
                            Male_Forestry_Marginal: d3.sum(d, function(e) {
                                return e['Male_Forestry_Marginal'];
                            }),
                            Male_B_Marginal: d3.sum(d, function(e) {
                                return e['Male_B_Marginal'];
                            }),
                            Male_C_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_C_HHI_Marginal'];
                            }),
                            Male_C_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_C_NonHHI_Marginal'];
                            }),
                            Male_DE_Marginal: d3.sum(d, function(e) {
                                return e['Male_DE_Marginal'];
                            }),
                            Male_F_Marginal: d3.sum(d, function(e) {
                                return e['Male_F_Marginal'];
                            }),
                            Male_G_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_G_HHI_Marginal'];
                            }),
                            Male_G_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_G_NonHHI_Marginal'];
                            }),
                            Male_H_Marginal: d3.sum(d, function(e) {
                                return e['Male_H_Marginal'];
                            }),
                            Male_I_Marginal: d3.sum(d, function(e) {
                                return e['Male_I_Marginal'];
                            }),
                            Male_J_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_J_HHI_Marginal'];
                            }),
                            Male_J_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_J_NonHHI_Marginal'];
                            }),
                            Male_KM_Marginal: d3.sum(d, function(e) {
                                return e['Male_KM_Marginal'];
                            }),
                            Male_NO_Marginal: d3.sum(d, function(e) {
                                return e['Male_NO_Marginal'];
                            }),
                            Male_PQ_Marginal: d3.sum(d, function(e) {
                                return e['Male_PQ_Marginal'];
                            }),
                            Male_RU_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_RU_HHI_Marginal'];
                            }),
                            Male_RU_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Male_RU_NonHHI_Marginal'];
                            }),
                        }
                    })
                    .entries(Data);

            }

            if (sex == "Female") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Female_Cultivators_Marginal: d3.sum(d, function(e) {
                                return e['Female_Cultivators_Marginal'];
                            }),
                            Female_Labourers_Marginal: d3.sum(d, function(e) {
                                return e['Female_Labourers_Marginal'];
                            }),
                            Female_Forestry_Marginal: d3.sum(d, function(e) {
                                return e['Female_Forestry_Marginal'];
                            }),
                            Female_B_Marginal: d3.sum(d, function(e) {
                                return e['Female_B_Marginal'];
                            }),
                            Female_C_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_C_HHI_Marginal'];
                            }),
                            Female_C_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_C_NonHHI_Marginal'];
                            }),
                            Female_DE_Marginal: d3.sum(d, function(e) {
                                return e['Female_DE_Marginal'];
                            }),
                            Female_F_Marginal: d3.sum(d, function(e) {
                                return e['Female_F_Marginal'];
                            }),
                            Female_G_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_G_HHI_Marginal'];
                            }),
                            Female_G_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_G_NonHHI_Marginal'];
                            }),
                            Female_H_Marginal: d3.sum(d, function(e) {
                                return e['Female_H_Marginal'];
                            }),
                            Female_I_Marginal: d3.sum(d, function(e) {
                                return e['Female_I_Marginal'];
                            }),
                            Female_J_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_J_HHI_Marginal'];
                            }),
                            Female_J_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_J_NonHHI_Marginal'];
                            }),
                            Female_KM_Marginal: d3.sum(d, function(e) {
                                return e['Female_KM_Marginal'];
                            }),
                            Female_NO_Marginal: d3.sum(d, function(e) {
                                return e['Female_NO_Marginal'];
                            }),
                            Female_PQ_Marginal: d3.sum(d, function(e) {
                                return e['Female_PQ_Marginal'];
                            }),
                            Female_RU_HHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_RU_HHI_Marginal'];
                            }),
                            Female_RU_NonHHI_Marginal: d3.sum(d, function(e) {
                                return e['Female_RU_NonHHI_Marginal'];
                            }),
                        }
                    })
                    .entries(Data);
            }


            var colourScale = d3.scaleOrdinal().domain(["Agricultural Labourers",
                "Cultivators",
                "Manufacturing",
                "Construction",
                "Trade",
                "Education and Health",
                "Administration and Defence",
                "Plantation etc",
                "Mining",
                "Other Services",
                "Transportation"
            ]).range(["b29f34",
                "789b3e",
                "637474",
                "33464d",
                "e58a2e",
                "734785",
                "23597c",
                "54603a",
                "161819",
                "bc352a",
                "ffffff"
            ]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                code = d.key
                item = d.value
                max = Object.keys(item).reduce((a, b) => item[a] > item[b] ? a : b);
                if (max == "Total_Cultivators_Marginal" || max == "Male_Cultivators_Marginal" || max == "Female_Cultivators_Marginal") {
                    max = "Cultivators"
                }
                if (max == "Total_Labourers_Marginal" || max == "Male_Labourers_Marginal" || max == "Female_Labourers_Marginal") {
                    max = "Agricultural Labourers"
                }
                if (max == "Total_Forestry_Marginal" || max == "Male_Forestry_Marginal" || max == "Female_Forestry_Marginal") {
                    max = "Plantation, Livestock, Forestry"
                }
                if (max == "Total_B_Marginal" || max == "Male_B_Marginal" || max == "Female_B_Marginal") {
                    max = "Mining"
                }
                if (max == "Total_C_HHI_Marginal" || max == "Male_C_HHI_Marginal" || max == "Female_C_HHI_Marginal") {
                    max = "Manufacturing"
                }
                if (max == "Total_C_NonHHI_Marginal" || max == "Male_C_NonHHI_Marginal" || max == "Female_C_NonHHI_Marginal") {
                    max = "Manufacturing"
                }
                if (max == "Total_F_Marginal" || max == "Male_F_Marginal" || max == "Female_F_Marginal") {
                    max = "Construction"
                }
                if (max == "Total_H_Marginal" || max == "Male_H_Marginal" || max == "Female_H_Marginal") {
                    max = "Transportation"
                }
                if (max == "Total_G_HHI_Marginal" || max == "Male_G_HHI_Marginal" || max == "Female_G_HHI_Marginal") {
                    max = "Trade"
                }
                if (max == "Total_G_NonHHI_Marginal" || max == "Male_G_NonHHI_Marginal" || max == "Female_G_NonHHI_Marginal") {
                    max = "Trade"
                }
                if (max == "Total_NO_Marginal" || max == "Male_NO_Marginal" || max == "Female_NO_Marginal") {
                    max = "Administration and Defence"
                }
                if (max == "Total_PQ_Marginal" || max == "Male_PQ_Marginal" || max == "Female_PQ_Marginal") {
                    max = "Education and Health"
                }
                if (max == "Total_RU_HHI_Marginal" || max == "Male_RU_HHI_Marginal" || max == "Female_RU_HHI_Marginal") {
                    max = "Other Services"
                }
                if (max == "Total_RU_NonHHI_Marginal" || max == "Male_RU_NonHHI_Marginal" || max == "Female_RU_NonHHI_Marginal") {
                    max = "Other Services"
                }
                districtData[code] = max;
                var colourState = colourScale(max);
                d3.select("#b" + code).transition().duration(1000).style("fill", colourState);
            })

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,20)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Industry")
                .scale(colourScale)

            svg.select(".legendQuant")
                .call(legend);


            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode]);
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })


        }

        function TotalLargestEmployer(Data, sex) {

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household) ")



            if (sex == "All") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Total_Cultivators_Total: d3.sum(d, function(e) {
                                return e['Total_Cultivators_Total'];
                            }),
                            Total_Labourers_Total: d3.sum(d, function(e) {
                                return e['Total_Labourers_Total'];
                            }),
                            Total_Forestry_Total: d3.sum(d, function(e) {
                                return e['Total_Forestry_Total'];
                            }),
                            Total_B_Total: d3.sum(d, function(e) {
                                return e['Total_B_Total'];
                            }),
                            Total_C_HHI_Total: d3.sum(d, function(e) {
                                return e['Total_C_HHI_Total'];
                            }),
                            Total_C_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Total_C_NonHHI_Total'];
                            }),
                            Total_DE_Total: d3.sum(d, function(e) {
                                return e['Total_DE_Total'];
                            }),
                            Total_F_Total: d3.sum(d, function(e) {
                                return e['Total_F_Total'];
                            }),
                            Total_G_HHI_Total: d3.sum(d, function(e) {
                                return e['Total_G_HHI_Total'];
                            }),
                            Total_G_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Total_G_NonHHI_Total'];
                            }),
                            Total_H_Total: d3.sum(d, function(e) {
                                return e['Total_H_Total'];
                            }),
                            Total_I_Total: d3.sum(d, function(e) {
                                return e['Total_I_Total'];
                            }),
                            Total_J_HHI_Total: d3.sum(d, function(e) {
                                return e['Total_J_HHI_Total'];
                            }),
                            Total_J_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Total_J_NonHHI_Total'];
                            }),
                            Total_KM_Total: d3.sum(d, function(e) {
                                return e['Total_KM_Total'];
                            }),
                            Total_NO_Total: d3.sum(d, function(e) {
                                return e['Total_NO_Total'];
                            }),
                            Total_PQ_Total: d3.sum(d, function(e) {
                                return e['Total_PQ_Total'];
                            }),
                            Total_RU_HHI_Total: d3.sum(d, function(e) {
                                return e['Total_RU_HHI_Total'];
                            }),
                            Total_RU_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Total_RU_NonHHI_Total'];
                            }),
                        }
                    })
                    .entries(Data);
            }

            if (sex = "Male") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Male_Cultivators_Total: d3.sum(d, function(e) {
                                return e['Male_Cultivators_Total'];
                            }),
                            Male_Labourers_Total: d3.sum(d, function(e) {
                                return e['Male_Labourers_Total'];
                            }),
                            Male_Forestry_Total: d3.sum(d, function(e) {
                                return e['Male_Forestry_Total'];
                            }),
                            Male_B_Total: d3.sum(d, function(e) {
                                return e['Male_B_Total'];
                            }),
                            Male_C_HHI_Total: d3.sum(d, function(e) {
                                return e['Male_C_HHI_Total'];
                            }),
                            Male_C_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Male_C_NonHHI_Total'];
                            }),
                            Male_DE_Total: d3.sum(d, function(e) {
                                return e['Male_DE_Total'];
                            }),
                            Male_F_Total: d3.sum(d, function(e) {
                                return e['Male_F_Total'];
                            }),
                            Male_G_HHI_Total: d3.sum(d, function(e) {
                                return e['Male_G_HHI_Total'];
                            }),
                            Male_G_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Male_G_NonHHI_Total'];
                            }),
                            Male_H_Total: d3.sum(d, function(e) {
                                return e['Male_H_Total'];
                            }),
                            Male_I_Total: d3.sum(d, function(e) {
                                return e['Male_I_Total'];
                            }),
                            Male_J_HHI_Total: d3.sum(d, function(e) {
                                return e['Male_J_HHI_Total'];
                            }),
                            Male_J_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Male_J_NonHHI_Total'];
                            }),
                            Male_KM_Total: d3.sum(d, function(e) {
                                return e['Male_KM_Total'];
                            }),
                            Male_NO_Total: d3.sum(d, function(e) {
                                return e['Male_NO_Total'];
                            }),
                            Male_PQ_Total: d3.sum(d, function(e) {
                                return e['Male_PQ_Total'];
                            }),
                            Male_RU_HHI_Total: d3.sum(d, function(e) {
                                return e['Male_RU_HHI_Total'];
                            }),
                            Male_RU_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Male_RU_NonHHI_Total'];
                            }),
                        }
                    })
                    .entries(Data);

            }

            if (sex == "Female") {
                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            Female_Cultivators_Total: d3.sum(d, function(e) {
                                return e['Female_Cultivators_Total'];
                            }),
                            Female_Labourers_Total: d3.sum(d, function(e) {
                                return e['Female_Labourers_Total'];
                            }),
                            Female_Forestry_Total: d3.sum(d, function(e) {
                                return e['Female_Forestry_Total'];
                            }),
                            Female_B_Total: d3.sum(d, function(e) {
                                return e['Female_B_Total'];
                            }),
                            Female_C_HHI_Total: d3.sum(d, function(e) {
                                return e['Female_C_HHI_Total'];
                            }),
                            Female_C_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Female_C_NonHHI_Total'];
                            }),
                            Female_DE_Total: d3.sum(d, function(e) {
                                return e['Female_DE_Total'];
                            }),
                            Female_F_Total: d3.sum(d, function(e) {
                                return e['Female_F_Total'];
                            }),
                            Female_G_HHI_Total: d3.sum(d, function(e) {
                                return e['Female_G_HHI_Total'];
                            }),
                            Female_G_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Female_G_NonHHI_Total'];
                            }),
                            Female_H_Total: d3.sum(d, function(e) {
                                return e['Female_H_Total'];
                            }),
                            Female_I_Total: d3.sum(d, function(e) {
                                return e['Female_I_Total'];
                            }),
                            Female_J_HHI_Total: d3.sum(d, function(e) {
                                return e['Female_J_HHI_Total'];
                            }),
                            Female_J_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Female_J_NonHHI_Total'];
                            }),
                            Female_KM_Total: d3.sum(d, function(e) {
                                return e['Female_KM_Total'];
                            }),
                            Female_NO_Total: d3.sum(d, function(e) {
                                return e['Female_NO_Total'];
                            }),
                            Female_PQ_Total: d3.sum(d, function(e) {
                                return e['Female_PQ_Total'];
                            }),
                            Female_RU_HHI_Total: d3.sum(d, function(e) {
                                return e['Female_RU_HHI_Total'];
                            }),
                            Female_RU_NonHHI_Total: d3.sum(d, function(e) {
                                return e['Female_RU_NonHHI_Total'];
                            }),
                        }
                    })
                    .entries(Data);
            }


            var colourScale = d3.scaleOrdinal().domain(["Agricultural Labourers",
                "Cultivators",
                "Manufacturing",
                "Construction",
                "Trade",
                "Education and Health",
                "Administration and Defence",
                "Plantation etc",
                "Mining",
                "Other Services",
                "Transportation"
            ]).range(["b29f34",
                "789b3e",
                "637474",
                "33464d",
                "e58a2e",
                "734785",
                "23597c",
                "54603a",
                "161819",
                "bc352a",
                "ffffff"
            ]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                code = d.key
                item = d.value
                max = Object.keys(item).reduce((a, b) => item[a] > item[b] ? a : b);
                if (max == "Total_Cultivators_Total" || max == "Male_Cultivators_Total" || max == "Female_Cultivators_Total") {
                    max = "Cultivators"
                }
                if (max == "Total_Labourers_Total" || max == "Male_Labourers_Total" || max == "Female_Labourers_Total") {
                    max = "Agricultural Labourers"
                }
                if (max == "Total_Forestry_Total" || max == "Male_Forestry_Total" || max == "Female_Forestry_Total") {
                    max = "Plantation, Livestock, Forestry"
                }
                if (max == "Total_B_Total" || max == "Male_B_Total" || max == "Female_B_Total") {
                    max = "Mining"
                }
                if (max == "Total_C_HHI_Total" || max == "Male_C_HHI_Total" || max == "Female_C_HHI_Total") {
                    max = "Manufacturing"
                }
                if (max == "Total_C_NonHHI_Total" || max == "Male_C_NonHHI_Total" || max == "Female_C_NonHHI_Total") {
                    max = "Manufacturing"
                }
                if (max == "Total_F_Total" || max == "Male_F_Total" || max == "Female_F_Total") {
                    max = "Construction"
                }
                if (max == "Total_H_Total" || max == "Male_H_Total" || max == "Female_H_Total") {
                    max = "Transportation"
                }
                if (max == "Total_G_HHI_Total" || max == "Male_G_HHI_Total" || max == "Female_G_HHI_Total") {
                    max = "Trade"
                }
                if (max == "Total_G_NonHHI_Total" || max == "Male_G_NonHHI_Total" || max == "Female_G_NonHHI_Total") {
                    max = "Trade"
                }
                if (max == "Total_NO_Total" || max == "Male_NO_Total" || max == "Female_NO_Total") {
                    max = "Administration and Defence"
                }
                if (max == "Total_PQ_Total" || max == "Male_PQ_Total" || max == "Female_PQ_Total") {
                    max = "Education and Health"
                }
                if (max == "Total_RU_HHI_Total" || max == "Male_RU_HHI_Total" || max == "Female_RU_HHI_Total") {
                    max = "Other Services"
                }
                if (max == "Total_RU_NonHHI_Total" || max == "Male_RU_NonHHI_Total" || max == "Female_RU_NonHHI_Total") {
                    max = "Other Services"
                }
                districtData[code] = max;
                var colourState = colourScale(max);
                d3.select("#b" + code).transition().duration(1000).style("fill", colourState);
            })

            svg.append("g")
                .attr("class", "legendQuant")
                .attr("transform", "translate(500,20)");

            var legend = d3.legendColor()
                .labelFormat(d3.format(".2f"))
                .title("Industry")
                .scale(colourScale)

            svg.select(".legendQuant")
                .call(legend);


            allDistricts.on("mouseover", function(d) {
                d3.select(this).classed("hover", true).style("stroke", "black").raise();
            })

            allDistricts.on("mousemove", function(d) {
                tooltip
                    .style("left", d3.event.pageX - 50 + "px")
                    .style("top", d3.event.pageY - 70 + "px")
                    .style("display", "inline-block")
                    .html(d.properties.DISTRICT + ", " + d.properties.ST_NM + "<br>" + districtData[d.properties.censuscode]);
            })

            allDistricts.on("mouseout", function(d) {
                d3.select(this).classed("hover", false).style("stroke", "transparent").lower();
                tooltip.style("display", "none");

            })


        }


        function PercentofLabourForce(Data, kindofworker) {

            d3.select("#notes").text("Labour Force is defined as the sum of all Regular workers, Seasonal workers and Job seeking Non Workers.")
            d3.selectAll(".item").remove()


            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            variable4 = "Total_Person_Nonworkers_Seeking"
            variable5 = variable1 + variable2 + variable3 + variable4

            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        }),
                        variable3: d3.sum(d, function(e) {
                            return e[variable3];
                        }),
                        variable4: d3.sum(d, function(e) {
                            return e[variable4];
                        })
                    }
                })
                .entries(Data);


            districtDatabyDistrict.forEach(function(d) {
                d.value['total_workforce'] = (d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4'])
                if (kindofworker == "Regular") {
                    d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['total_workforce'])
                }
                if (kindofworker == "Seasonal") {
                    d.value['percentage'] = (((d.value['variable2']) + (d.value['variable3']) * 100) / d.value['total_workforce'])

                }
                if (kindofworker == "All") {
                    d.value['percentage'] = (((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100 / d.value['total_workforce'])

                }
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#B2C483", "#81A53E"]);
            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })

            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                }

                if (kindofworker == "Regular") {

                    percentage_n = (variablen1 * 100) / (variablen1 + variablen2 + variablen3 + variablen4).toFixed(2);
                }

                if (kindofworker == "Seasonal") {
                    percentage_n = ((variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3 + variablen4).toFixed(2);

                }
                if (kindofworker == "All") {
                    percentage_n = ((variablen1 = variablen2 + variablen3) * 100) / (variablen1 + variablen2 + variablen3 + variablen4).toFixed(2);

                }
                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = kindofworker + " workers as % of Labour force"
            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);

        }


        function MainDetailedIndustries(Data, domain) {

            d3.selectAll(".item").remove()

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household). Further breakdown of the categories is presented as industries above.")


            if (domain == "Farm") {

                variable1 = "Total_Cultivators_Main"
                variable2 = "Total_Labourers_Main"
                variable3 = "Total_Forestry_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Non-Farm") {

                variable1 = "Total_Cultivators_Main"
                variable2 = "Total_Labourers_Main"
                variable3 = "Total_Forestry_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = 100 - ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Manufacturing") {

                variable1 = "Total_B_Main"
                variable2 = "Total_C_HHI_Main"
                variable3 = "Total_C_NonHHI_Main"
                variable4 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Trade") {

                variable1 = "Total_G_HHI_Main"
                variable2 = "Total_G_NonHHI_Main"
                variable3 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']))) * 100) / d.value['variable3']
                })

            }

            if (domain == "Construction") {

                variable1 = "Total_F_Main"
                variable2 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1'])) * 100) / d.value['variable2'])
                })

            }

            if (domain == "Services") {

                variable1 = "Total_DE_Main"
                variable2 = "Total_G_HHI_Main"
                variable3 = "Total_G_NonHHI_Main"
                variable4 = "Total_H_Main"
                variable5 = "Total_I_Main"
                variable6 = "Total_J_HHI_Main"
                variable7 = "Total_J_NonHHI_Main"
                variable8 = "Total_KM_Main"
                variable9 = "Total_NO_Main"
                variable10 = "Total_PQ_Main"
                variable11 = "Total_RU_HHI_Main"
                variable12 = "Total_RU_NonHHI_Main"
                variable13 = "Total_Workers_Main"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                            variable5: d3.sum(d, function(e) {
                                return e[variable5];
                            }),
                            variable6: d3.sum(d, function(e) {
                                return e[variable6];
                            }),
                            variable7: d3.sum(d, function(e) {
                                return e[variable7];
                            }),
                            variable8: d3.sum(d, function(e) {
                                return e[variable8];
                            }),
                            variable9: d3.sum(d, function(e) {
                                return e[variable9];
                            }),
                            variable10: d3.sum(d, function(e) {
                                return e[variable10];
                            }),
                            variable11: d3.sum(d, function(e) {
                                return e[variable11];
                            }),
                            variable12: d3.sum(d, function(e) {
                                return e[variable12];
                            }),
                            variable13: d3.sum(d, function(e) {
                                return e[variable13];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4']) + (d.value['variable5']) + (d.value['variable6']) + (d.value['variable7']) + (d.value['variable8']) + (d.value['variable9']) + (d.value['variable10']) + (d.value['variable11']) + (d.value['variable12'])) * 100) / d.value['variable13'])
                })

            }

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);



            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                var variablen5 = 0
                var variablen6 = 0
                var variablen7 = 0
                var variablen8 = 0
                var variablen9 = 0
                var variablen10 = 0
                var variablen11 = 0
                var variablen12 = 0
                var variablen13 = 0

                if (domain == "Farm" || domain == "Manufacturing") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return percentage_n;


                }
                if (domain == "Services") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                        variablen5 = variablen5 + (districtDatabyDistrict[id_no - 1].value['variable5'])
                        variablen6 = variablen6 + (districtDatabyDistrict[id_no - 1].value['variable6'])
                        variablen7 = variablen7 + (districtDatabyDistrict[id_no - 1].value['variable7'])
                        variablen8 = variablen8 + (districtDatabyDistrict[id_no - 1].value['variable8'])
                        variablen9 = variablen9 + (districtDatabyDistrict[id_no - 1].value['variable9'])
                        variablen10 = variablen10 + (districtDatabyDistrict[id_no - 1].value['variable10'])
                        variablen11 = variablen11 + (districtDatabyDistrict[id_no - 1].value['variable11'])
                        variablen12 = variablen12 + (districtDatabyDistrict[id_no - 1].value['variable12'])
                        variablen13 = variablen13 + (districtDatabyDistrict[id_no - 1].value['variable13'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3 + variablen4 + variablen5 + variablen6 + variablen7 + variablen8 + variablen9 + variablen10 + variablen11 + variablen12) * 100) / (variablen13).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Trade") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    }

                    percentage_n = ((variablen1 + variablen2) * 100) / (variablen3).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Non-Farm") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return 100 - percentage_n;


                }
            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = "% of All regular workers in " + domain + " industry"


            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);


        }

        function MarginalDetailedIndustries(Data, domain) {

            d3.selectAll(".item").remove()

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household). Further breakdown of the categories is presented as industries above.")


            if (domain == "Farm") {

                variable1 = "Total_Cultivators_Marginal"
                variable2 = "Total_Labourers_Marginal"
                variable3 = "Total_Forestry_Marginal"
                variable4 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Non-Farm") {


                variable1 = "Total_Cultivators_Marginal"
                variable2 = "Total_Labourers_Marginal"
                variable3 = "Total_Forestry_Marginal"
                variable4 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = 100 - ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Manufacturing") {

                variable1 = "Total_B_Marginal"
                variable2 = "Total_C_HHI_Marginal"
                variable3 = "Total_C_NonHHI_Marginal"
                variable4 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Trade") {

                variable1 = "Total_G_HHI_Marginal"
                variable2 = "Total_G_NonHHI_Marginal"
                variable3 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']))) * 100) / d.value['variable3']
                })

            }

            if (domain == "Construction") {

                variable1 = "Total_F_Marginal"
                variable2 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1'])) * 100) / d.value['variable2'])
                })

            }

            if (domain == "Services") {

                variable1 = "Total_DE_Marginal"
                variable2 = "Total_G_HHI_Marginal"
                variable3 = "Total_G_NonHHI_Marginal"
                variable4 = "Total_H_Marginal"
                variable5 = "Total_I_Marginal"
                variable6 = "Total_J_HHI_Marginal"
                variable7 = "Total_J_NonHHI_Marginal"
                variable8 = "Total_KM_Marginal"
                variable9 = "Total_NO_Marginal"
                variable10 = "Total_PQ_Marginal"
                variable11 = "Total_RU_HHI_Marginal"
                variable12 = "Total_RU_NonHHI_Marginal"
                variable13 = "Total_Workers_Marginal"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                            variable5: d3.sum(d, function(e) {
                                return e[variable5];
                            }),
                            variable6: d3.sum(d, function(e) {
                                return e[variable6];
                            }),
                            variable7: d3.sum(d, function(e) {
                                return e[variable7];
                            }),
                            variable8: d3.sum(d, function(e) {
                                return e[variable8];
                            }),
                            variable9: d3.sum(d, function(e) {
                                return e[variable9];
                            }),
                            variable10: d3.sum(d, function(e) {
                                return e[variable10];
                            }),
                            variable11: d3.sum(d, function(e) {
                                return e[variable11];
                            }),
                            variable12: d3.sum(d, function(e) {
                                return e[variable12];
                            }),
                            variable13: d3.sum(d, function(e) {
                                return e[variable13];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4']) + (d.value['variable5']) + (d.value['variable6']) + (d.value['variable7']) + (d.value['variable8']) + (d.value['variable9']) + (d.value['variable10']) + (d.value['variable11']) + (d.value['variable12'])) * 100) / d.value['variable13'])
                })

            }

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);

            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);



            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                var variablen5 = 0
                var variablen6 = 0
                var variablen7 = 0
                var variablen8 = 0
                var variablen9 = 0
                var variablen10 = 0
                var variablen11 = 0
                var variablen12 = 0
                var variablen13 = 0

                if (domain == "Farm" || domain == "Manufacturing") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return percentage_n;


                }
                if (domain == "Services") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                        variablen5 = variablen5 + (districtDatabyDistrict[id_no - 1].value['variable5'])
                        variablen6 = variablen6 + (districtDatabyDistrict[id_no - 1].value['variable6'])
                        variablen7 = variablen7 + (districtDatabyDistrict[id_no - 1].value['variable7'])
                        variablen8 = variablen8 + (districtDatabyDistrict[id_no - 1].value['variable8'])
                        variablen9 = variablen9 + (districtDatabyDistrict[id_no - 1].value['variable9'])
                        variablen10 = variablen10 + (districtDatabyDistrict[id_no - 1].value['variable10'])
                        variablen11 = variablen11 + (districtDatabyDistrict[id_no - 1].value['variable11'])
                        variablen12 = variablen12 + (districtDatabyDistrict[id_no - 1].value['variable12'])
                        variablen13 = variablen13 + (districtDatabyDistrict[id_no - 1].value['variable13'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3 + variablen4 + variablen5 + variablen6 + variablen7 + variablen8 + variablen9 + variablen10 + variablen11 + variablen12) * 100) / (variablen13).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Trade") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    }

                    percentage_n = ((variablen1 + variablen2) * 100) / (variablen3).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Non-Farm") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return 100 - percentage_n;


                }
            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = "% of All regular workers in " + domain + " industry"


            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);


        }

        function TotalDetailedIndustries(Data, domain) {

            d3.selectAll(".item").remove()

            d3.select("#notes").text("Farm consists of Cultivators, Agricultural Labourers and Forestry, Plantation etc category workers of the National Industrial Classification (2008). Manufacturing includes B and C (Household) and C (Non Household) categories. Trade is G (Household) and G (Non Household) according to the NIC. Construction is F. Services include DE, G(Household), G(Non Household), H, I, JM, NO, PQ and RU(Household) and RU (Non Household). Further breakdown of the categories is presented as industries above.")


            if (domain == "Farm") {

                variable1 = "Total_Cultivators_Total"
                variable2 = "Total_Labourers_Total"
                variable3 = "Total_Forestry_Total"
                variable4 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Non-Farm") {

                variable1 = "Total_Cultivators_Total"
                variable2 = "Total_Labourers_Total"
                variable3 = "Total_Forestry_Total"
                variable4 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = 100 - ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Manufacturing") {

                variable1 = "Total_B_Total"
                variable2 = "Total_C_HHI_Total"
                variable3 = "Total_C_NonHHI_Total"
                variable4 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3'])) * 100) / d.value['variable4'])
                })

            }

            if (domain == "Trade") {

                variable1 = "Total_G_HHI_Total"
                variable2 = "Total_G_NonHHI_Total"
                variable3 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']))) * 100) / d.value['variable3']
                })

            }

            if (domain == "Construction") {

                variable1 = "Total_F_Total"
                variable2 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1'])) * 100) / d.value['variable2'])
                })

            }

            if (domain == "Services") {

                variable1 = "Total_DE_Total"
                variable2 = "Total_G_HHI_Total"
                variable3 = "Total_G_NonHHI_Total"
                variable4 = "Total_H_Total"
                variable5 = "Total_I_Total"
                variable6 = "Total_J_HHI_Total"
                variable7 = "Total_J_NonHHI_Total"
                variable8 = "Total_KM_Total"
                variable9 = "Total_NO_Total"
                variable10 = "Total_PQ_Total"
                variable11 = "Total_RU_HHI_Total"
                variable12 = "Total_RU_NonHHI_Total"
                variable13 = "Total_Workers_Total"


                var districtDatabyDistrict = d3.nest()
                    .key(function(d) {
                        return +d.District_Code;
                    })
                    .rollup(function(d) {
                        return {
                            variable1: d3.sum(d, function(e) {
                                return e[variable1];
                            }),
                            district: d[0].District_Code,
                            district_name: d[0].Area_Name,
                            variable2: d3.sum(d, function(e) {
                                return e[variable2];
                            }),
                            variable3: d3.sum(d, function(e) {
                                return e[variable3];
                            }),
                            variable4: d3.sum(d, function(e) {
                                return e[variable4];
                            }),
                            variable5: d3.sum(d, function(e) {
                                return e[variable5];
                            }),
                            variable6: d3.sum(d, function(e) {
                                return e[variable6];
                            }),
                            variable7: d3.sum(d, function(e) {
                                return e[variable7];
                            }),
                            variable8: d3.sum(d, function(e) {
                                return e[variable8];
                            }),
                            variable9: d3.sum(d, function(e) {
                                return e[variable9];
                            }),
                            variable10: d3.sum(d, function(e) {
                                return e[variable10];
                            }),
                            variable11: d3.sum(d, function(e) {
                                return e[variable11];
                            }),
                            variable12: d3.sum(d, function(e) {
                                return e[variable12];
                            }),
                            variable13: d3.sum(d, function(e) {
                                return e[variable13];
                            }),
                        }
                    }).entries(Data);


                districtDatabyDistrict.forEach(function(d) {
                    d.value['percentage'] = ((((d.value['variable1']) + (d.value['variable2']) + (d.value['variable3']) + (d.value['variable4']) + (d.value['variable5']) + (d.value['variable6']) + (d.value['variable7']) + (d.value['variable8']) + (d.value['variable9']) + (d.value['variable10']) + (d.value['variable11']) + (d.value['variable12'])) * 100) / d.value['variable13'])
                })

            }

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#6BA2CE", "#0E88BF"]);



            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {

                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []

            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }

            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })
            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                var variablen5 = 0
                var variablen6 = 0
                var variablen7 = 0
                var variablen8 = 0
                var variablen9 = 0
                var variablen10 = 0
                var variablen11 = 0
                var variablen12 = 0
                var variablen13 = 0

                if (domain == "Farm" || domain == "Manufacturing") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return percentage_n;


                }
                if (domain == "Services") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])
                        variablen5 = variablen5 + (districtDatabyDistrict[id_no - 1].value['variable5'])
                        variablen6 = variablen6 + (districtDatabyDistrict[id_no - 1].value['variable6'])
                        variablen7 = variablen7 + (districtDatabyDistrict[id_no - 1].value['variable7'])
                        variablen8 = variablen8 + (districtDatabyDistrict[id_no - 1].value['variable8'])
                        variablen9 = variablen9 + (districtDatabyDistrict[id_no - 1].value['variable9'])
                        variablen10 = variablen10 + (districtDatabyDistrict[id_no - 1].value['variable10'])
                        variablen11 = variablen11 + (districtDatabyDistrict[id_no - 1].value['variable11'])
                        variablen12 = variablen12 + (districtDatabyDistrict[id_no - 1].value['variable12'])
                        variablen13 = variablen13 + (districtDatabyDistrict[id_no - 1].value['variable13'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3 + variablen4 + variablen5 + variablen6 + variablen7 + variablen8 + variablen9 + variablen10 + variablen11 + variablen12) * 100) / (variablen13).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Trade") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    }

                    percentage_n = ((variablen1 + variablen2) * 100) / (variablen3).toFixed(2);
                    return percentage_n;

                }

                if (domain == "Non-Farm") {
                    for (item = 0; item < (lengthofids); item++) {
                        id_no = city[item]

                        variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                        variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                        variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                        variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])


                    }

                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                    return 100 - percentage_n;


                }
            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = "% of All workers in " + domain



            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);


        }


        function PercentofTotalPopulation(Data, kindofworker) {

            d3.select("#notes").text("Total Workforce is defined as the sum of all Regular and Seasonal workers. The above values are as proportion of population between those ages.")
            d3.selectAll(".item").remove()

            variable1 = "Total_Workers_Main"
            variable2 = "Total_Workers_3mon_Marginal"
            variable3 = "Total_Workers_6mon_Marginal"
            variable4 = "Total_Population"
            var districtDatabyDistrict = d3.nest()
                .key(function(d) {
                    return +d.District_Code;
                })
                .rollup(function(d) {
                    return {
                        variable1: d3.sum(d, function(e) {
                            return e[variable1];
                        }),
                        district: d[0].District_Code,
                        district_name: d[0].Area_Name,
                        variable2: d3.sum(d, function(e) {
                            return e[variable2];
                        }),
                        variable3: d3.sum(d, function(e) {
                            return e[variable3];
                        }),
                        variable4: d3.sum(d, function(e) {
                            return e[variable4];
                        }),
                    }
                })
                .entries(Data);

            districtDatabyDistrict.forEach(function(d) {
                if (kindofworker == "Regular") {
                    d.value['percentage'] = ((d.value['variable1']) * 100 / d.value['variable4'])
                }
                if (kindofworker == "Seasonal") {
                    d.value['percentage'] = ((((d.value['variable2'] + (d.value['variable3'])) * 100) / d.value['variable4']))
                }
                if (kindofworker == "All") {
                    d.value['percentage'] = (d.value['variable1'] + d.value['variable2'] + d.value['variable3']) * 100 / d.value['variable4']
                }
            })

            var items = districtDatabyDistrict.map(post => +post.value['percentage']);
            var colourScale = d3.scaleQuantile().domain(items).range(["#FAB816", "#FFD27C", "#B2C483", "#81A53E"]);


            var districtData = {}
            districtDatabyDistrict.forEach(function(d) {
                district_variable_count = parseInt(d.value['district'])
                districtData[district_variable_count] = d.value['percentage']
                var colourState = colourScale(d.value['percentage']);
                d3.select("#b" + district_variable_count).transition().duration(1000).style("fill", colourState);
            })

            var sorted = []


            for (var district in districtData) {
                sorted.push([district, districtData[district]])
            }


            sorted.sort(function(a, b) {
                return b[1] - a[1]
            })

            var top10list = []

            var count = 0
            while (count < 10) {
                id = sorted[count][0]
                district_name = districtDatabyDistrict[id - 1].value['district_name'].substring(11)
                district_percentage = sorted[count][1].toFixed(2)
                top10list.push([district_name, district_percentage])
                d3.select("#b" + sorted[count][0]).transition().duration(1000).style("fill", "#7F4C94");
                count = count + 1

            }

            d3.select("#top10listheader").text(" TOP 10 DISTRICTS ")


            d3.select('#top10list')
                .selectAll('.item')
                .data(top10list)
                .enter()
                .append('li')
                .classed('item', true)
                .text(function(d) { return d[0] })
                .append("text").text(": ")
                .append("text").text(function(d) { return d[1] })
                .append("text").text("%");


            function UrbanAggCalculator(city) {
                lengthofids = city.length
                var variablen1 = 0
                var variablen2 = 0
                var variablen3 = 0
                var variablen4 = 0
                for (item = 0; item < (lengthofids); item++) {
                    id_no = city[item]

                    variablen1 = variablen1 + (districtDatabyDistrict[id_no - 1].value['variable1'])
                    variablen2 = variablen2 + (districtDatabyDistrict[id_no - 1].value['variable2'])
                    variablen3 = variablen3 + (districtDatabyDistrict[id_no - 1].value['variable3'])
                    variablen4 = variablen4 + (districtDatabyDistrict[id_no - 1].value['variable4'])

                }

                if (kindofworker == "Regular") {
                    percentage_n = (variablen1 * 100) / (variablen4).toFixed(2);
                }

                if (kindofworker == "Seasonal") {
                    percentage_n = ((variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                }

                if (kindofworker == "All") {
                    percentage_n = ((variablen1 + variablen2 + variablen3) * 100) / (variablen4).toFixed(2);
                }

                return percentage_n;

            }


            city_array = [UrbanAggCalculator(Hyderabad), UrbanAggCalculator(Bangalore), UrbanAggCalculator(Chennai), UrbanAggCalculator(Kolkata), UrbanAggCalculator(Mumbai), UrbanAggCalculator(Delhi)]

            title = kindofworker + " workers as % of Total population"

            drawLegendandTooltip(colourScale, districtData, "yes", title);
            Annotate(city_array);

        }


        function Main_Workers() {

            worker_keys = ["% of Total population", "% of Total workers", "% of Labour force", "Regular workers by industry", "Largest employer", "Change since 2001 (% pts)"];


            d3.select('#datagroups')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {


                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons")
                    .style("background", d => d === datapoint ? backgroundColour : "transparent")
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".ageButtons").remove()
                d3.selectAll(".annotation-group").remove();
                d3.selectAll(".legendQuant").remove()
                d3.selectAll(".sexButtons").remove()


                if (datapoint == "% of Total population") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    PercentofTotalPopulation(newData, "Regular");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')


                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofTotalPopulation(newData, "Regular");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            PercentofTotalPopulation(newData, "Regular");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofTotalPopulation(newData, "Regular");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofTotalPopulation(newData, "Regular");

                        }

                    }

                }




                if (datapoint == "% of Total workers") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    PercentofTotalWorkers(newData, "Regular");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('optin')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofTotalWorkers(newData, "Regular");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            PercentofTotalWorkers(newData, "Regular");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofTotalWorkers(newData, "Regular");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofTotalWorkers(newData, "Regular");

                        }

                    }

                }


                if (datapoint == "% of Labour force") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    })

                    PercentofLabourForce(newData, "Regular");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofLabourForce(newData, "Regular");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "Regular");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "Regular");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofLabourForce(newData, "Regular");

                        }
                    }

                }


                if (datapoint == "Regular workers by industry") {


                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.select("#industryheader").text(" FILTER BY INDUSTRY ")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")



                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".categoryButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    category_keys = ["Farm",
                        "Manufacturing",
                        "Trade",
                        "Construction",
                        "Services", "Non-Farm",
                    ];

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });



                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(category_keys)
                        .enter()
                        .append("button")
                        .on("click", categoryClick)
                        .attr("id", d => d)
                        .attr("class", "categoryButtons")
                        .html(function(d) {
                            return d;
                        })

                    categoryClick("Non-Farm")



                    function categoryClick(domain) {
                        d3.selectAll(".categoryButtons").style("background", "transparent")
                        d3.select("#" + domain).style("background", backgroundColour)
                        d3.selectAll(".dataButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".ageButtons").remove()
                        d3.selectAll(".sexButtons").remove()

                        newData = FinalData.filter(function(d) {
                            return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                        });
                        MainDetailedIndustries(newData, domain)



                        age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                        var select = d3.select('#ageviews')
                            .append('select')
                            .attr('class', 'ageButtons')
                            .on('change', parameterClick)

                        var options = select
                            .selectAll('option')
                            .data(age_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        var domain = domain
                        var dropdown = "dropdown1"

                        if (domain == "Farm") {
                            industry_keys = ["Cultivators", "Farm Labourers", "Plantation etc"]
                        }
                        if (domain == "Manufacturing") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)"]
                        }
                        if (domain == "Trade") {
                            industry_keys = ["Trade(Household)", "Trade(Non Household)"]
                        }
                        if (domain == "Services") {
                            industry_keys = ["Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }
                        if (domain == "Non-Farm") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)", "Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }

                        if (domain == "Construction") {
                            d3.select("#industryheader").text("")
                            d3.select("#sexheader").text("")
                            d3.select("#ageheader").text("")
                        }


                        var select = d3.select('#detailedindustries')
                            .append('select')
                            .attr('class', 'industryButtons')
                            .on('change', industryClick)

                        var options = select
                            .selectAll('option')
                            .data(industry_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        function industryClick() {

                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            dropdown = "dropdown2"
                            datapoint = d3.select(this).property('value')


                            if (datapoint == "Cultivators") {
                                variable = "Total_Cultivators_Main"

                            }
                            if (datapoint == "Farm Labourers") {
                                variable = "Total_Labourers_Main"

                            }
                            if (datapoint == "Plantation etc") {
                                variable = "Total_Forestry_Main"

                            }

                            if (datapoint == "Mining") {
                                variable = "Total_B_Main"

                            }
                            if (datapoint == "Manufacturing (Household)") {
                                variable = "Total_C_HHI_Main"

                            }
                            if (datapoint == "Manufacturing (Non Household)") {
                                variable = "Total_C_NonHHI_Main"
                            }

                            if (datapoint == "Trade(Household)") {
                                variable = "Total_G_HHI_Main"

                            }
                            if (datapoint == "Trade(Non Household)") {
                                variable = "Total_G_NonHHI_Main"

                            }
                            if (datapoint == "Construction") {
                                variable = "Total_F_Main"

                            }
                            if (datapoint == "Utilities") {
                                variable = "Total_DE_Main"

                            }
                            if (datapoint == "Hospitality") {
                                variable = "Total_I_Main"

                            }
                            if (datapoint == "Transportation") {
                                variable = "Total_H_Main"

                            }
                            if (datapoint == "IT (Household)") {
                                variable = "Total_J_HHI_Main"
                            }

                            if (datapoint == "IT (Non Household)") {
                                variable = "Total_J_NonHHI_Main"
                            }

                            if (datapoint == "Finance") {
                                variable = "Total_KM_Main"

                            }
                            if (datapoint == "Administration and Defence") {
                                variable = "Total_NO_Main"

                            }
                            if (datapoint == "Education and Health") {
                                variable = "Total_PQ_Main"

                            }
                            if (datapoint == "Other Services (Household)") {
                                variable = "Total_RU_HHI_Main"

                            }
                            if (datapoint == "Other Services (Non Household)") {
                                variable = "Total_RU_NonHHI_Main"

                            }


                            MainWorkersByIndustry(newData, variable, domain)

                        }

                        function parameterClick() {
                            datapoint = d3.select(this).property('value')
                            if (datapoint == "Child workers (<15 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "5-9" || d.Age == "10-14"))
                                });

                                if (dropdown == "dropdown1") {
                                    MainDetailedIndustries(newData, domain);
                                } else {
                                    MainWorkersByIndustry(newData, variable, domain);
                                }

                            }

                            if (datapoint == "15-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    MainDetailedIndustries(newData, domain);
                                } else {
                                    MainWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "25-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    MainDetailedIndustries(newData, domain);
                                } else {
                                    MainWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "Senior workers (>60 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                                });


                                if (dropdown == "dropdown1") {
                                    MainDetailedIndustries(newData, domain);
                                } else {
                                    MainWorkersByIndustry(newData, variable, domain);
                                }


                            }

                        }

                    }

                }

                if (datapoint == "Largest employer") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text(" FILTER BY SEX ")
                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#top10listheader").text("")
                    d3.selectAll(".item").remove()

                    d3.selectAll(".categoryButtons").style("background", "transparent")
                    d3.select(this).style("background", backgroundColour)
                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    sex = "All"


                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    sex_keys = ["All", "Male", "Female"]



                    var select = d3.select('#sexviews')
                        .append('select')
                        .attr('class', 'sexButtons')
                        .on('change', sexClick)

                    var options = select
                        .selectAll('option')
                        .data(sex_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    function sexClick() {
                        datapoint = d3.select(this).property('value')
                        sex = datapoint
                        MainLargestEmployer(newData, sex);

                    }


                    MainLargestEmployer(newData, sex);



                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            MainLargestEmployer(newData, sex);

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49"


                                    ||
                                    d.Age == "50-59"))
                            });

                            MainLargestEmployer(newData, sex);

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            MainLargestEmployer(newData, sex);

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            MainLargestEmployer(newData, sex);

                        }
                    }

                }


                if (datapoint == "Change since 2001 (% pts)") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")

                    d3.select("#notes").text("For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")

                    worker_keys = ["Regular workers", "Regular Male Workers", "Regular Female Workers",
                        "Farm",
                        "Manufacturing",
                        "Construction",
                        "Trade",
                        "Services"
                    ];


                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(worker_keys)
                        .enter()
                        .append("button")
                        .on("click", parameterClick)
                        .attr("id", d => d)
                        .attr("class", "dataButtons")
                        .style("background", (d, i) => i === 0 ? backgroundColour : "transparent")
                        .html(function(d) {
                            return d;
                        })

                    var variable = "PPChangeinMain";


                    ChangeSince2001(B415, variable, "Regular")

                    function parameterClick(datapoint) {
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)
                        if (datapoint == "Regular workers") {

                            variable = "PPChangeinMain"

                        }

                        if (datapoint == "Regular Male Workers") {

                            variable = "PPChangeinMainMale"

                        }
                        if (datapoint == "Regular Female Workers") {

                            variable = "PPChangeinMainFemale"

                        }

                        if (datapoint == "Farm") {

                            variable = "PPChangeAgriculture"

                        }
                        if (datapoint == "Manufacturing") {

                            variable = "PPChangeinManufacturing"

                        }
                        if (datapoint == "Trade") {

                            variable = "PPChangeinWholesale"

                        }
                        if (datapoint == "Services") {

                            variable = "PPChangeinServices"

                        }
                        if (datapoint == "Construction") {

                            variable = "PPChangeinConstruction"

                        }

                        if (datapoint == "Non Agricultural Work") {

                            variable = "PPChangeinNonAgriculturalWork"

                        }

                        ChangeSince2001(B415, variable, "Regular")


                    }



                    age_keys = ["15-59 years", "25-59 years"];
                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', ageFUNCTION)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    var file;


                    function ageFUNCTION(datapoint) {
                        d3.selectAll(".categoryButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".sexButtons").remove()


                        datapoint = d3.select(this).property('value')

                        if (datapoint == "15-59 years") {
                            ChangeSince2001(B415, variable, "Regular")
                        }
                        if (datapoint == "25-59 years") {
                            ChangeSince2001(B425, variable, "Regular")
                        }

                    }

                }


            }

        }

        function Marginal_Workers() {

            worker_keys = ["% of Total population", "% of Total workers", "% of Labour force", "Seasonal workers by industry", "Largest employer", "Change since 2001 (% pts)"];


            d3.select('#datagroups')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {


                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons")
                    .style("background", d => d === datapoint ? backgroundColour : "transparent")
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".ageButtons").remove()
                d3.selectAll(".annotation-group").remove();
                d3.selectAll(".legendQuant").remove()
                d3.selectAll(".sexButtons").remove()


                if (datapoint == "% of Total population") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    PercentofTotalPopulation(newData, "Seasonal");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofTotalPopulation(newData, "Seasonal");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            PercentofTotalPopulation(newData, "Seasonal");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofTotalPopulation(newData, "Seasonal");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofTotalPopulation(newData, "Seasonal");

                        }

                    }

                }




                if (datapoint == "% of Total workers") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    PercentofTotalWorkers(newData, "Seasonal");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('optin')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofTotalWorkers(newData, "Seasonal");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            PercentofTotalWorkers(newData, "Seasonal");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofTotalWorkers(newData, "Seasonal");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofTotalWorkers(newData, "Seasonal");

                        }

                    }

                }


                if (datapoint == "% of Labour force") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    })

                    PercentofLabourForce(newData, "Seasonal");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofLabourForce(newData, "Seasonal");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "Seasonal");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "Seasonal");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofLabourForce(newData, "Seasonal");

                        }
                    }

                }


                if (datapoint == "Seasonal workers by industry") {


                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.select("#industryheader").text(" FILTER BY INDUSTRY ")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")



                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".categoryButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    category_keys = ["Farm",
                        "Manufacturing",
                        "Trade",
                        "Construction",
                        "Services", "Non-Farm",
                    ];

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });



                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(category_keys)
                        .enter()
                        .append("button")
                        .on("click", categoryClick)
                        .attr("id", d => d)
                        .attr("class", "categoryButtons")
                        .html(function(d) {
                            return d;
                        })

                    categoryClick("Non-Farm")



                    function categoryClick(domain) {
                        d3.selectAll(".categoryButtons").style("background", "transparent")
                        d3.select("#" + domain).style("background", backgroundColour)
                        d3.selectAll(".dataButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".ageButtons").remove()
                        d3.selectAll(".sexButtons").remove()

                        newData = FinalData.filter(function(d) {
                            return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                        });


                        MarginalDetailedIndustries(newData, domain)



                        age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                        var select = d3.select('#ageviews')
                            .append('select')
                            .attr('class', 'ageButtons')
                            .on('change', parameterClick)

                        var options = select
                            .selectAll('option')
                            .data(age_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        var domain = domain
                        var dropdown = "dropdown1"

                        if (domain == "Farm") {
                            industry_keys = ["Cultivators", "Farm Labourers", "Plantation etc"]
                        }
                        if (domain == "Manufacturing") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)"]
                        }
                        if (domain == "Trade") {
                            industry_keys = ["Trade(Household)", "Trade(Non Household)"]
                        }
                        if (domain == "Services") {
                            industry_keys = ["Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }
                        if (domain == "Non-Farm") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)", "Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }
                        if (domain == "Construction") {
                            d3.select("#industryheader").text("")
                            d3.select("#sexheader").text("")
                            d3.select("#ageheader").text("")
                        }



                        var select = d3.select('#detailedindustries')
                            .append('select')
                            .attr('class', 'industryButtons')
                            .on('change', industryClick)

                        var options = select
                            .selectAll('option')
                            .data(industry_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        function industryClick() {

                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            dropdown = "dropdown2"
                            datapoint = d3.select(this).property('value')


                            if (datapoint == "Cultivators") {
                                variable = "Total_Cultivators_Marginal"

                            }
                            if (datapoint == "Farm Labourers") {
                                variable = "Total_Labourers_Marginal"

                            }
                            if (datapoint == "Plantation etc") {
                                variable = "Total_Forestry_Marginal"

                            }

                            if (datapoint == "Mining") {
                                variable = "Total_B_Marginal"

                            }
                            if (datapoint == "Manufacturing (Household)") {
                                variable = "Total_C_HHI_Marginal"

                            }
                            if (datapoint == "Manufacturing (Non Household)") {
                                variable = "Total_C_NonHHI_Marginal"
                            }

                            if (datapoint == "Trade(Household)") {
                                variable = "Total_G_HHI_Marginal"

                            }
                            if (datapoint == "Trade(Non Household)") {
                                variable = "Total_G_NonHHI_Marginal"

                            }
                            if (datapoint == "Construction") {
                                variable = "Total_F_Marginal"

                            }
                            if (datapoint == "Utilities") {
                                variable = "Total_DE_Marginal"

                            }
                            if (datapoint == "Hospitality") {
                                variable = "Total_I_Marginal"

                            }
                            if (datapoint == "Transportation") {
                                variable = "Total_H_Marginal"

                            }
                            if (datapoint == "IT (Household)") {
                                variable = "Total_J_HHI_Marginal"
                            }

                            if (datapoint == "IT (Non Household)") {
                                variable = "Total_J_NonHHI_Marginal"
                            }

                            if (datapoint == "Finance") {
                                variable = "Total_KM_Marginal"

                            }
                            if (datapoint == "Administration and Defence") {
                                variable = "Total_NO_Marginal"

                            }
                            if (datapoint == "Education and Health") {
                                variable = "Total_PQ_Marginal"

                            }
                            if (datapoint == "Other Services (Household)") {
                                variable = "Total_RU_HHI_Marginal"

                            }
                            if (datapoint == "Other Services (Non Household)") {
                                variable = "Total_RU_NonHHI_Marginal"

                            }


                            MarginalWorkersByIndustry(newData, variable, domain)

                        }

                        function parameterClick() {
                            datapoint = d3.select(this).property('value')
                            if (datapoint == "Child workers (<15 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "5-9" || d.Age == "10-14"))
                                });

                                if (dropdown == "dropdown1") {
                                    MarginalDetailedIndustries(newData, domain);
                                } else {
                                    MarginalWorkersByIndustry(newData, variable, domain);
                                }

                            }

                            if (datapoint == "15-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    MarginalDetailedIndustries(newData, domain);
                                } else {
                                    MarginalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "25-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    MarginalDetailedIndustries(newData, domain);
                                } else {
                                    MarginalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "Senior workers (>60 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                                });


                                if (dropdown == "dropdown1") {
                                    MarginalDetailedIndustries(newData, domain);
                                } else {
                                    MarginalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                        }

                    }

                }

                if (datapoint == "Largest employer") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text(" FILTER BY SEX ")
                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#top10listheader").text("")
                    d3.selectAll(".item").remove()




                    d3.selectAll(".categoryButtons").style("background", "transparent")
                    d3.select(this).style("background", backgroundColour)
                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    sex = "All"


                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    MarginalLargestEmployer(newData, sex);

                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    sex_keys = ["All", "Male", "Female"]



                    var select = d3.select('#sexviews')
                        .append('select')
                        .attr('class', 'sexButtons')
                        .on('change', sexClick)

                    var options = select
                        .selectAll('option')
                        .data(sex_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    function sexClick() {
                        datapoint = d3.select(this).property('value')
                        sex = datapoint
                    }


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            MarginalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49"


                                    ||
                                    d.Age == "50-59"))
                            });

                            MarginalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            MarginalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            MarginalLargestEmployer(newData, sex);

                        }
                    }

                }


                if (datapoint == "Change since 2001 (% pts)") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")

                    d3.select("#notes").text("For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")

                    worker_keys = ["Seasonal workers", "Seasonal Male Workers", "Seasonal Female Workers",
                        "Farm",
                        "Manufacturing",
                        "Construction",
                        "Trade",
                        "Services"
                    ];


                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(worker_keys)
                        .enter()
                        .append("button")
                        .on("click", parameterClick)
                        .attr("id", d => d)
                        .attr("class", "dataButtons")
                        .style("background", (d, i) => i === 0 ? backgroundColour : "transparent")
                        .html(function(d) {
                            return d;
                        })

                    var variable = "PPChangeinMarginal";


                    ChangeSince2001(B615, variable, "Seasonal")

                    function parameterClick(datapoint) {
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)
                        if (datapoint == "Seasonal workers") {

                            variable = "PPChangeinMarginal"

                        }

                        if (datapoint == "Seasonal Male Workers") {

                            variable = "PPChangeinMarginalMale"

                        }
                        if (datapoint == "Seasonal Female Workers") {

                            variable = "PPChangeinMarginalFemale"

                        }

                        if (datapoint == "Farm") {

                            variable = "PPChangeAgriculture"

                        }
                        if (datapoint == "Manufacturing") {

                            variable = "PPChangeinManufacturing"

                        }
                        if (datapoint == "Trade") {

                            variable = "PPChangeinWholesale"

                        }
                        if (datapoint == "Services") {

                            variable = "PPChangeinServices"

                        }
                        if (datapoint == "Construction") {

                            variable = "PPChangeinConstruction"

                        }

                        if (datapoint == "Non Agricultural Work") {

                            variable = "PPChangeinNonAgriculturalWork"

                        }

                        ChangeSince2001(B615, variable, "Seasonal")


                    }



                    age_keys = ["15-59 years", "25-59 years"];
                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', ageFUNCTION)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    var file;


                    function ageFUNCTION(datapoint) {

                        d3.selectAll(".categoryButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".sexButtons").remove()


                        datapoint = d3.select(this).property('value')

                        if (datapoint == "15-59 years") {
                            ChangeSince2001(B615, variable, "Seasonal")
                        }
                        if (datapoint == "25-59 years") {
                            ChangeSince2001(B625, variable, "Seasonal")
                        }

                    }

                }

            }

        }

        function Total_Workers(initial) {

            worker_keys = ["% of Total population", "% of Labour force", "Total workers by industry", "Largest employer", "Change since 2001 (% pts)"];


            d3.select('#datagroups')
                .selectAll("path")
                .data(worker_keys)
                .enter()
                .append("button")
                .on("click", workerKeyClick)
                .attr("id", d => d)
                .attr("class", "parameterButtons")
                .html(function(d) {
                    return d;
                })


            function workerKeyClick(datapoint) {


                d3.selectAll(".district")
                    .style("fill", "#f0f0f0")
                    .style("stroke", "transparent")
                d3.selectAll(".parameterButtons")
                    .style("background", d => d === datapoint ? backgroundColour : "transparent")
                d3.selectAll(".dataButtons").remove()
                d3.selectAll(".categoryButtons").remove()
                d3.selectAll(".industryButtons").remove()
                d3.selectAll(".ageButtons").remove()
                d3.selectAll(".annotation-group").remove();
                d3.selectAll(".legendQuant").remove()
                d3.selectAll(".sexButtons").remove()


                if (datapoint == "% of Total population") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    PercentofTotalPopulation(newData, "All");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofTotalPopulation(newData, "All");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });


                            PercentofTotalPopulation(newData, "All");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofTotalPopulation(newData, "All");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofTotalPopulation(newData, "All");

                        }

                    }

                }


                if (datapoint == "% of Labour force") {

                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#sexheader").text("")
                    d3.select("#industryheader").text("")

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    })

                    PercentofLabourForce(newData, "All");


                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];

                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            PercentofLabourForce(newData, "All");

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "All");

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            PercentofLabourForce(newData, "All");

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            PercentofLabourForce(newData, "All");

                        }
                    }

                }


                if (datapoint == "Total workers by industry") {


                    d3.select("#notes").text("Agriculture includes Agriculture, Forestry and Fishing workers. Manufacturing includes Mining and Quarrying workers. While Wholesale and Retail Trade are also displayed separately, their numbers are included in the Services category too. Detailed Breakdown provides a granular look at these industries. Workers by Industry at a District Level is defined as Percentage of Workers in the industry to the Total number of workers in that district. Workers by Industry at a Total Level is defined as percentage of workers in that district to the total number of workers across the country. ")

                    d3.select("#industryheader").text(" FILTER BY INDUSTRY ")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")



                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".categoryButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    category_keys = ["Farm",
                        "Manufacturing",
                        "Trade",
                        "Construction",
                        "Services", "Non-Farm",
                    ];

                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });



                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(category_keys)
                        .enter()
                        .append("button")
                        .on("click", categoryClick)
                        .attr("id", d => d)
                        .attr("class", "categoryButtons")
                        .html(function(d) {
                            return d;
                        })

                    categoryClick("Non-Farm")



                    function categoryClick(domain) {
                        d3.selectAll(".categoryButtons").style("background", "transparent")
                        d3.select("#" + domain).style("background", backgroundColour)
                        d3.selectAll(".dataButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".ageButtons").remove()
                        d3.selectAll(".sexButtons").remove()

                        newData = FinalData.filter(function(d) {
                            return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                        });
                        TotalDetailedIndustries(newData, domain)



                        age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                        var select = d3.select('#ageviews')
                            .append('select')
                            .attr('class', 'ageButtons')
                            .on('change', parameterClick)

                        var options = select
                            .selectAll('option')
                            .data(age_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        var domain = domain
                        var dropdown = "dropdown1"

                        if (domain == "Farm") {
                            industry_keys = ["Cultivators", "Farm Labourers", "Plantation etc"]
                        }
                        if (domain == "Manufacturing") {
                            industry_keys = ["Manufacturing (Household)", "Manufacturing (Non Household)"]
                        }
                        if (domain == "Trade") {
                            industry_keys = ["Trade(Household)", "Trade(Non Household)"]
                        }
                        if (domain == "Services") {
                            industry_keys = ["Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }
                        if (domain == "Non-Farm") {
                            industry_keys = ["Mining", "Manufacturing (Household)", "Manufacturing (Non Household)", "Utilities", "Trade (Household)", "Trade(Non Household)", "Transportation", "Hospitality", "IT (Household)", "IT (Non Household)", "Finance", "Administration and Defence", "Education and Health", "Other Services (Household)", "Other Services(Non Household)"]
                        }

                        if (domain == "Construction") {

                            d3.select("#industryheader").text("")
                            d3.select("#sexheader").text("")
                            d3.select("#ageheader").text("")
                        }



                        var select = d3.select('#detailedindustries')
                            .append('select')
                            .attr('class', 'industryButtons')
                            .on('change', industryClick)

                        var options = select
                            .selectAll('option')
                            .data(industry_keys).enter()
                            .append('option')
                            .text(function(d) {
                                return d;
                            });


                        function industryClick() {

                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            dropdown = "dropdown2"
                            datapoint = d3.select(this).property('value')


                            if (datapoint == "Cultivators") {
                                variable = "Total_Cultivators_Total"

                            }
                            if (datapoint == "Farm Labourers") {
                                variable = "Total_Labourers_Total"

                            }
                            if (datapoint == "Plantation etc") {
                                variable = "Total_Forestry_Total"

                            }

                            if (datapoint == "Mining") {
                                variable = "Total_B_Total"

                            }
                            if (datapoint == "Manufacturing (Household)") {
                                variable = "Total_C_HHI_Total"

                            }
                            if (datapoint == "Manufacturing (Non Household)") {
                                variable = "Total_C_NonHHI_Total"
                            }

                            if (datapoint == "Trade(Household)") {
                                variable = "Total_G_HHI_Total"

                            }
                            if (datapoint == "Trade(Non Household)") {
                                variable = "Total_G_NonHHI_Total"

                            }
                            if (datapoint == "Construction") {
                                variable = "Total_F_Total"

                            }
                            if (datapoint == "Utilities") {
                                variable = "Total_DE_Total"

                            }
                            if (datapoint == "Hospitality") {
                                variable = "Total_I_Total"

                            }
                            if (datapoint == "Transportation") {
                                variable = "Total_H_Total"

                            }
                            if (datapoint == "IT (Household)") {
                                variable = "Total_J_HHI_Total"
                            }

                            if (datapoint == "IT (Non Household)") {
                                variable = "Total_J_NonHHI_Total"
                            }

                            if (datapoint == "Finance") {
                                variable = "Total_KM_Total"

                            }
                            if (datapoint == "Administration and Defence") {
                                variable = "Total_NO_Total"

                            }
                            if (datapoint == "Education and Health") {
                                variable = "Total_PQ_Total"

                            }
                            if (datapoint == "Other Services (Household)") {
                                variable = "Total_RU_HHI_Total"

                            }
                            if (datapoint == "Other Services (Non Household)") {
                                variable = "Total_RU_NonHHI_Total"

                            }


                            TotalWorkersByIndustry(newData, variable, domain)

                        }

                        function parameterClick() {
                            datapoint = d3.select(this).property('value')
                            if (datapoint == "Child workers (<15 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "5-9" || d.Age == "10-14"))
                                });

                                if (dropdown == "dropdown1") {
                                    TotalDetailedIndustries(newData, domain);
                                } else {
                                    TotalWorkersByIndustry(newData, variable, domain);
                                }

                            }

                            if (datapoint == "15-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    TotalDetailedIndustries(newData, domain);
                                } else {
                                    TotalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "25-59 years") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                                });

                                if (dropdown == "dropdown1") {
                                    TotalDetailedIndustries(newData, domain);
                                } else {
                                    TotalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                            if (datapoint == "Senior workers (>60 years)") {
                                newData = FinalData.filter(function(d) {
                                    return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                                });


                                if (dropdown == "dropdown1") {
                                    TotalDetailedIndustries(newData, domain);
                                } else {
                                    TotalWorkersByIndustry(newData, variable, domain);
                                }


                            }

                        }

                    }

                }

                if (datapoint == "Largest employer") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text(" FILTER BY SEX ")
                    d3.select("#ageheader").text(" FILTER BY AGE ")
                    d3.select("#top10listheader").text("")
                    d3.selectAll(".item").remove()




                    d3.selectAll(".categoryButtons").style("background", "transparent")
                    d3.select(this).style("background", backgroundColour)
                    d3.selectAll(".dataButtons").remove()
                    d3.selectAll(".industryButtons").remove()
                    d3.selectAll(".ageButtons").remove()
                    d3.selectAll(".sexButtons").remove()

                    sex = "All"


                    newData = FinalData.filter(function(d) {
                        return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                    });

                    TotalLargestEmployer(newData, sex);

                    age_keys = ["15-59 years", "25-59 years", "Child workers (<15 years)", "Senior workers (>60 years)"];


                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', parameterClick)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    sex_keys = ["All", "Male", "Female"]



                    var select = d3.select('#sexviews')
                        .append('select')
                        .attr('class', 'sexButtons')
                        .on('change', sexClick)

                    var options = select
                        .selectAll('option')
                        .data(sex_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    function sexClick() {
                        datapoint = d3.select(this).property('value')
                        sex = datapoint
                    }


                    function parameterClick(datapoint) {
                        datapoint = d3.select(this).property('value')
                        d3.selectAll(".dataButtons").style("background", "transparent")

                        if (datapoint == "Child workers (<15 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "5-9" || d.Age == "10-14"))
                            });


                            TotalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "15-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "15-19" || d.Age == "20-24" || d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49"


                                    ||
                                    d.Age == "50-59"))
                            });

                            TotalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "25-59 years") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "25-29" || d.Age == "30-34" || d.Age == "35-39" || d.Age == "40-49" || d.Age == "50-59"))
                            });

                            TotalLargestEmployer(newData, sex);

                        }

                        if (datapoint == "Senior workers (>60 years)") {
                            newData = FinalData.filter(function(d) {
                                return ((d.Age == "60-69" || d.Age == "70-79" || d.Age == "80+"))
                            });


                            TotalLargestEmployer(newData, sex);

                        }
                    }

                }


                if (datapoint == "Change since 2001 (% pts)") {

                    d3.select("#industryheader").text("")
                    d3.select("#sexheader").text("")
                    d3.select("#ageheader").text(" FILTER BY AGE ")

                    d3.select("#notes").text("Because of a change in Industrial Classification categories between the 2001 and 2008 Census, Comparisions are appropriate at a macro-industry level. For districts whose boundaries have been changed since 2001, we have made the following assumptions. For districts with one parent, the comparisons are made for both the old and new district against the 2001 district. For districts with multiple parents, the smallest cohesive common boundary was considered.")

                    worker_keys = ["Farm",
                        "Manufacturing",
                        "Construction",
                        "Trade",
                        "Services"
                    ];


                    d3.select('#industryviews')
                        .selectAll("path")
                        .data(worker_keys)
                        .enter()
                        .append("button")
                        .on("click", parameterClick)
                        .attr("id", d => d)
                        .attr("class", "dataButtons")
                        .style("background", (d, i) => i === 0 ? backgroundColour : "transparent")
                        .html(function(d) {
                            return d;
                        })

                    var variable = "PPChangeAgriculture";


                    ChangeSince2001(B4B615, variable, "All")

                    function parameterClick(datapoint) {
                        d3.selectAll(".dataButtons").style("background", "transparent")
                        d3.select(this).style("background", backgroundColour)

                        if (datapoint == "Farm") {

                            variable = "PPChangeAgriculture"

                        }
                        if (datapoint == "Manufacturing") {

                            variable = "PPChangeinManufacturing"

                        }
                        if (datapoint == "Trade") {

                            variable = "PPChangeinWholesale"

                        }
                        if (datapoint == "Services") {

                            variable = "PPChangeinServices"

                        }
                        if (datapoint == "Construction") {

                            variable = "PPChangeinConstruction"

                        }

                        if (datapoint == "Non Agricultural Work") {

                            variable = "PPChangeinNonAgriculturalWork"

                        }

                        ChangeSince2001(B4B615, variable, "All")


                    }



                    age_keys = ["15-59 years", "25-59 years"];
                    var select = d3.select('#ageviews')
                        .append('select')
                        .attr('class', 'ageButtons')
                        .on('change', ageFUNCTION)

                    var options = select
                        .selectAll('option')
                        .data(age_keys).enter()
                        .append('option')
                        .text(function(d) {
                            return d;
                        });

                    var file;


                    function ageFUNCTION(datapoint) {
                        d3.selectAll(".categoryButtons").remove()
                        d3.selectAll(".industryButtons").remove()
                        d3.selectAll(".sexButtons").remove()


                        datapoint = d3.select(this).property('value')

                        if (datapoint == "15-59 years") {
                            ChangeSince2001(B4B615, variable, "All")
                        }
                        if (datapoint == "25-59 years") {
                            ChangeSince2001(B4B625, variable, "All")
                        }

                    }

                }


            }

            if (initial === true) {
                workerKeyClick(worker_keys[0])
            }

        }


        Total_Workers(true)

    }
    </script>
</body>

</html>